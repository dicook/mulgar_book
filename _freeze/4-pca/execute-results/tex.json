{
  "hash": "7b04e958e8d7a8e143a789f2f0712b47",
  "result": {
    "engine": "knitr",
    "markdown": "## Principal component analysis \n\nReducing dimensionality using principal component analysis (PCA) dates back to @pearson-pca and @hotelling-pca, and @joliffe2016 provides a current overview. The goal is to find a smaller set of variables, $q (< p)$, that contain as much information as the original as possible. The new set of variables, known as principal components (PCs), are linear combinations of the original variables. The PCs can be used to represent the data in a lower-dimensional space.\n\nThe process is essentially an optimisation procedure, although PCA has an analytical solution. It solves the problem of \n\n$$\n\\max_{a_k} ~\\text{Var} (Xa_k),\n$$\nwhere $X$ is the $n \\times p$ data matrix, $a_k (k=1, ..., p)$ is a 1D projection vector, called an eigenvector, and the $\\text{Var} (Xa_k)$ is called an eigenvalue. So PCA is a sequential process, that will find the direction in the high-dimensional space (as given by the first eigenvector) where the data is most varied, and then find the second most varied direction, and so on. The eigenvectors define the combination of the original variables, and the eigenvalues define the amount of variance explained by the reduced number of variables.\n\nPCA is very broadly useful for summarising linear association by using combinations of variables that are highly correlated. However, high correlation can also occur when there are outliers, or clustering. PCA is commonly used to detect these patterns also.\n\n::: {.content-visible when-format=\"html\"}\n::: info\nWith visualisation we want to assess whether it is appropriate to use PCA to summarise any linear association by using combinations of variables that are highly correlated. It can help to detect other patterns that might affect the PCA results such as outliers, clustering or non-linear dependence. \n:::\n:::\n\n::: {.content-visible when-format=\"pdf\"}\n\\infobox{With visualisation we want to assess whether it is appropriate to use PCA to summarise any linear association by using combinations of variables that are highly correlated. It can help to detect other patterns that might affect the PCA results such as outliers, clustering or non-linear dependence.}\n:::\n\n\nPCA is not very effective when the distribution of the variables is highly skewed, so it can be helpful to transform variables to make them more symmetrically distributed before conducting PCA. It is also possible to summarise different types of structure by generalising the optimisation criteria to any function of projected data, $f(XA)$, which is called *projection pursuit* (PP). PP has a long history (@Kr64a, @FT74, @DF84, @JS87, @Hu85), and there are regularly new developments (e.g. @Lee2009, @perisic2009, @Lee2013, @loperfido, @bickel2018, @zhang2023). \n\n## Determining how many dimensions\n\nWe would start by examining the data using a grand tour. The goal is to check whether there might be potential issues for PCA, such as skewness, outliers or clustering, or even non-linear dependencies.\n\nWe'll start be showing PCA on the simulated data from @sec-dimension-overview. The scree plots show that PCA supports that the data are 2D, 3D and 5D respectively.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(mulgar)\ndata(plane)\ndata(box)\nlibrary(geozoo)\ncube5d <- data.frame(cube.solid.random(p=5, n=300)$points)\ncolnames(cube5d) <- paste0(\"x\", 1:5)\ncube5d <- data.frame(apply(cube5d, 2, function(x) (x-mean(x))/sd(x)))\np_pca <- prcomp(plane)\nb_pca <- prcomp(box)\nc_pca <- prcomp(cube5d)\np_scree <- ggscree(p_pca, q = 5) + theme_minimal()\n\nb_scree <- ggscree(b_pca, q = 5) + theme_minimal()\nc_scree <- ggscree(c_pca, q = 5) + theme_minimal()\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Scree plots for the three simulated data sets shown in Figure 3.2. The 2D in 5D is clearly recognised by PCA to be 2D because the variance drops substantially between 2-3 principal components. The 3D in 5D is possibly 3D because the variance drops from 3-4 principal components. The fully 5D data has no drop in variance, and all values are close to the typical value one would observe if the data was fully 5D.](4-pca_files/figure-pdf/fig-2D-pca-1.pdf){#fig-2D-pca width=100%}\n:::\n:::\n\n\n\n\nThe next step is to look at the coefficients for the selected number of PCs. @tbl-plane-pcs shows the coefficients for the first two PCs of the `plane` data. All five variables contribute, with `x1`, `x2`, `x3` contributing more to `PC1`, and `x4`, `x5` contributing more to `PC2`. @tbl-box-pcs shows the coefficients for the first three PCs. Variables `x1`, `x2`, `x3` contribute strongly to `PC1`, `PC2` has contributions from all variables except `x3` and variables `x4` and `x5` contribute strongly to `PC3`. \n\n\n\n::: {#tbl-plane-pcs .cell tbl-cap='Coefficients for the first two PCs for the plane data.'}\n\n```{.r .cell-code  code-summary=\"Code to print PC coefficients\"}\nlibrary(gt)\np_pca$rotation[,1:2] %>%\n  as_tibble(rownames=\"Variable\") %>% \n  gt() %>%\n  fmt_number(columns = c(PC1, PC2),\n             decimals = 2)\n```\n\n::: {.cell-output-display}\n\\begin{longtable}{lrr}\n\\toprule\nVariable & PC1 & PC2 \\\\ \n\\midrule\nx1 & $0.58$ & $-0.06$ \\\\ \nx2 & $-0.55$ & $0.21$ \\\\ \nx3 & $0.47$ & $-0.41$ \\\\ \nx4 & $0.25$ & $0.64$ \\\\ \nx5 & $-0.29$ & $-0.62$ \\\\ \n\\bottomrule\n\\end{longtable}\n\n:::\n:::\n\n::: {#tbl-box-pcs .cell tbl-cap='Coefficients for the first three PCs for the box data.'}\n\n```{.r .cell-code  code-summary=\"Code to print PC coefficients\"}\nb_pca$rotation[,1:3] %>%\n  as_tibble(rownames=\"Variable\") %>% \n  gt() %>%\n  fmt_number(columns = c(PC1, PC2, PC3),\n             decimals = 2)\n```\n\n::: {.cell-output-display}\n\\begin{longtable}{lrrr}\n\\toprule\nVariable & PC1 & PC2 & PC3 \\\\ \n\\midrule\nx1 & $-0.51$ & $0.46$ & $0.11$ \\\\ \nx2 & $0.51$ & $0.46$ & $0.00$ \\\\ \nx3 & $-0.65$ & $-0.09$ & $0.23$ \\\\ \nx4 & $-0.22$ & $0.36$ & $-0.87$ \\\\ \nx5 & $0.02$ & $0.66$ & $0.43$ \\\\ \n\\bottomrule\n\\end{longtable}\n\n:::\n:::\n\n\n\nIn each of these simulated data sets, all five variables contributed to the dimension reduction. If we added two purely noise variables to the plane data, as done in @sec-dimension-overview, the scree plot would indicate that the data is now 4D, and we would get a different interpretation of the coefficients from the PCA. We see that `PC1` and `PC2` are approximately the same as before, with main variables being (`x1`, `x2`, `x3`) and (`x4`, `x5`) respectively. `PC3` and `PC4` are both `x6` and `x7`. \n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nset.seed(5143)\nplane_noise <- plane\nplane_noise$x6 <- rnorm(100)\nplane_noise$x7 <- rnorm(100)\nplane_noise <- data.frame(apply(plane_noise, 2, function(x) (x-mean(x))/sd(x)))\n\npn_pca <- prcomp(plane_noise)\nggscree(pn_pca, q = 7) + theme_minimal()\n```\n\n::: {.cell-output-display}\n![Additional noise variables expands the data to 4D.](4-pca_files/figure-pdf/fig-plane-noise-scree-1.pdf){#fig-plane-noise-scree fig-pos='H' width=80%}\n:::\n:::\n\n::: {#tbl-plane-noise-pcs .cell tbl-cap='Coefficients for the first four PCs for the box data.'}\n\n```{.r .cell-code  code-summary=\"Code to print PC coefficients\"}\npn_pca$rotation[,1:4] %>%\n  as_tibble(rownames=\"Variable\") %>% \n  gt() %>%\n  fmt_number(columns = c(PC1, PC2, PC3, PC4),\n             decimals = 2)\n```\n\n::: {.cell-output-display}\n\\begin{longtable}{lrrrr}\n\\toprule\nVariable & PC1 & PC2 & PC3 & PC4 \\\\ \n\\midrule\nx1 & $0.58$ & $0.04$ & $0.01$ & $0.00$ \\\\ \nx2 & $-0.55$ & $-0.18$ & $-0.03$ & $0.07$ \\\\ \nx3 & $0.47$ & $0.37$ & $0.05$ & $-0.20$ \\\\ \nx4 & $0.24$ & $-0.62$ & $-0.06$ & $0.17$ \\\\ \nx5 & $-0.28$ & $0.60$ & $0.07$ & $-0.14$ \\\\ \nx6 & $0.05$ & $0.29$ & $-0.58$ & $0.76$ \\\\ \nx7 & $-0.02$ & $-0.08$ & $-0.81$ & $-0.58$ \\\\ \n\\bottomrule\n\\end{longtable}\n\n:::\n:::\n\n\n\n### Example: pisa\n\nThe `pisa` data contains simulated data from math, reading and science scores, totalling 30 variables. PCA is used here to examine the association. We might expect that it is 3D, but what we see suggests it is primarily 1D. This means that a student that scores well in math, will also score well in reading and science. \n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\ndata(pisa)\npisa_std <- pisa %>%\n  filter(CNT == \"Australia\") %>%\n  select(-CNT) %>%\n  mutate_all(mulgar:::scale2)\npisa_pca <- prcomp(pisa_std)\npisa_scree <- ggscree(pisa_pca, q = 15) + theme_minimal()\n```\n:::\n\n\n\nThe scree plot in @fig-pisa-pca-pdf shows a big drop from one to two PCs in the amount of variance explained. A grand tour on the 30 variables can be run using `animate_xy()`: \n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nanimate_xy(pisa_std, half_range=1)\n```\n:::\n\n\n\nor rendered as an animated gif using `render_gif()`:\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nrender_gif(pisa_std, \n           grand_tour(), \n           display_xy(half_range=0.9),\n           gif_file=\"gifs/pisa_gt.gif\",\n           frames=500,\n           width=400,\n           height=400,\n           loop=FALSE)\n```\n:::\n\n\n\nand we can see that the data is elliptical in most projections, sometimes shrinking to be a small circle. This pattern strongly indicates that there is one primary direction of variation in the data, with only small variation in any direction away from it. Shrinking to the small circle is analogous to to how *a pencil or cigar or water bottle in 3D looks from some angles*.\n\n::: {.content-visible when-format=\"html\"}\n::: {#fig-pisa-pca-html  fig-align=\"center\" layout-ncol=2}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Scree plot for the PCA on the pisa data suggests that the data is 1D.](4-pca_files/figure-pdf/unnamed-chunk-10-1.pdf){width=80%}\n:::\n:::\n\n\n\n![Grand tour of the pisa data.](gifs/pisa_gt.gif){#fig-pisa-gt fig-alt=\"Tour showing lots of linear projections of the pisa data. You can see strong linear dependence.\" fig.align=\"center\"}\n\nScree plot and tour of the `pisa` data, with 30 variables being the plausible scores for Australian students.\n:::\n:::\n\n::: {.content-visible when-format=\"pdf\"}\n::: {#fig-pisa-pca-pdf  fig-align=\"center\" layout-ncol=2}\n\n![](images/fig-pisa-scree-1.png){fig-alt=\"FIX ME\"}\n\n![Grand tour of the pisa data.](images/pisa_gt_249.png){#fig-pisa-gt fig-alt=\"Selected linear projection of the pisa data from a grand tour. You can see strong linear dependence.\" fig.align=\"center\"}\n\nScree plot and tour of the `pisa` data, with 30 variables being the plausible scores for Australian students.\n:::\n:::\n\nThe coefficients of the first PC (first eigenvector) are roughly equal in magnitude (as shown below), which tells us that all variables roughly contribute. Interestingly, they are all negative, which is not actually meaningful. With different software these could easily have been all positive. The sign of the coefficients can be reversed, as long as all are reversed, which is the same as an arrow pointing one way, changing and pointing the other way.   \n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Code to print PC coefficients\"}\nround(pisa_pca$rotation[,1], 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n PV1MATH  PV2MATH  PV3MATH  PV4MATH  PV5MATH  PV6MATH \n   -0.18    -0.18    -0.18    -0.18    -0.18    -0.18 \n PV7MATH  PV8MATH  PV9MATH PV10MATH  PV1READ  PV2READ \n   -0.18    -0.18    -0.18    -0.18    -0.19    -0.18 \n PV3READ  PV4READ  PV5READ  PV6READ  PV7READ  PV8READ \n   -0.19    -0.19    -0.19    -0.19    -0.19    -0.19 \n PV9READ PV10READ  PV1SCIE  PV2SCIE  PV3SCIE  PV4SCIE \n   -0.19    -0.19    -0.18    -0.18    -0.19    -0.18 \n PV5SCIE  PV6SCIE  PV7SCIE  PV8SCIE  PV9SCIE PV10SCIE \n   -0.19    -0.18    -0.19    -0.18    -0.19    -0.18 \n```\n\n\n:::\n:::\n\n\n\n::: {.content-visible when-format=\"html\"}\n::: insight\nThe tour verifies that the `pisa` data is primarily 1D, indicating that a student who scores well in math, probably scores well in reading and science, too. More interestingly, the regular shape of the data strongly indicates that it is \"synthetic\", simulated rather than observed.\n:::\n:::\n\n::: {.content-visible when-format=\"pdf\"}\n\\insightbox{The tour verifies that the `pisa` data is primarily 1D, indicating that a student who scores well in math, probably scores well in reading and science, too. More interestingly, the regular shape of the data strongly indicates that it is \"synthetic\", simulated rather than observed.}\n:::\n\n### Example: aflw\n\nThis data has player statistics for all the matches in the 2021 season. We would be interested to know which variables contain similar information, and thus might be combined into single variables. We would expect that many statistics to group into a few small sets, such as offensive and defensive skills. We might also expect that some of the statistics are skewed, most players have low values and just a handful of players are stellar. It is also possible that there are some extreme values. These are interesting features, but they will distract from the main purpose of grouping the statistics. Thus the tour is used to check for potential problems with the data prior to conducting PCA.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(tourr)\ndata(aflw)\naflw_std <- aflw %>%\n  mutate_if(is.numeric, function(x) (x-\n      mean(x, na.rm=TRUE))/\n      sd(x, na.rm=TRUE))\n```\n:::\n\n\n\nTo look at all of the 29 player statistics in a grand tour in @fig-aflw-gt-pdf.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Code to generate tour\"}\nanimate_xy(aflw_std[,7:35], half_range=0.9)\nrender_gif(aflw_std[,7:35], \n           grand_tour(), \n           display_xy(half_range=0.9),\n           gif_file=\"gifs/aflw_gt.gif\",\n           frames=500,\n           loop=FALSE)\n```\n:::\n\n\n\n::: {.content-visible when-format=\"html\"}\n::: {#fig-aflw-gt-html}\n\n![](gifs/aflw_gt.gif){fig-alt=\"Tour showing lots of linear projections of the aflw data. You can see linear dependence, and some outliers.\" fig.align=\"center\"}\n\nGrand tour of the AFLW player statistics.\n:::\n:::\n\n::: {.content-visible when-format=\"pdf\"}\n::: {#fig-aflw-gt-pdf fig.align=\"center\" fig-alt=\"Example linear projection of the aflw data from a grand tour. You can see linear dependence, and some outliers.\"}\n\n![](images/aflw_gt_70.png){}\n\nGrand tour of the AFLW player statistics.\n:::\n:::\n\nNo major surprises! There is a small amount of skewness, and there are no major outliers. Skewness indicates that most players have reasonably similar skills (bunching of points), except for some key players (the moderate outliers). The skewness could be reduced by applying a log or square root transformation to some variables prior to running the PCA. However, we elect not to do this because the moderate outliers are of interest. These correspond to talented players that we'd like to explore further with the analysis.\n\nBelow we have the conventional summary of the PCA, a scree plot showing the reduction in variance to be explained when each additional PC is considered. It is also conventional to look at a table summarising the proportions of variance explained by PCs, but with almost 30 variables it is easier to make some decision on the number of PCs needed based on the scree plot.\n\n\n\n::: {.cell alt-text='Scree plot showing variance vertically against PC number horizontally. Variance drops from close to 10 for PC 1 to about 1.2 for PC 4 then slowly decays through to PC 29'}\n\n```{.r .cell-code  code-summary=\"Code to make screeplot\"}\naflw_pca <- prcomp(aflw_std[,7:35], \n               scale = FALSE, \n               retx=TRUE)\n\nggscree(aflw_pca, q = 29) + theme_minimal()\n```\n\n::: {.cell-output-display}\n![Scree plot showing decay in variance of PCs.](4-pca_files/figure-pdf/fig-aflw-pca-1.pdf){#fig-aflw-pca fig-pos='H' width=80%}\n:::\n:::\n\n\n\nFrom the scree plot in @fig-aflw-pca, we see a sharp drop from one to two, two to three and then smaller drops. After four PCs the variance drops again at six PCs and then gradually decays. We will choose four PCs to examine more closely. This explains 67.2% of the variance.\n\n\n\n::: {#tbl-aflw-pcs .cell tbl-cap='Coefficients for the first four PCs.'}\n\n```{.r .cell-code  code-summary=\"Code to print PC coefficients\"}\nlibrary(gt)\naflw_pca$rotation[,1:4] %>%\n  as_tibble(rownames=\"Variable\") %>% \n  arrange(desc(PC1), desc(PC2), desc(PC3)) %>%\n  gt() %>%\n  fmt_number(columns = c(PC1, PC2, PC3, PC4),\n             decimals = 2)\n```\n\n::: {.cell-output-display}\n\\begin{longtable}{lrrrr}\n\\toprule\nVariable & PC1 & PC2 & PC3 & PC4 \\\\ \n\\midrule\ndisposals & $0.31$ & $-0.05$ & $-0.03$ & $0.07$ \\\\ \npossessions & $0.31$ & $-0.03$ & $-0.07$ & $0.09$ \\\\ \nkicks & $0.29$ & $-0.04$ & $0.09$ & $-0.12$ \\\\ \nmetres & $0.28$ & $-0.03$ & $0.10$ & $-0.15$ \\\\ \ncontested & $0.28$ & $0.01$ & $-0.12$ & $0.23$ \\\\ \nuncontested & $0.28$ & $-0.06$ & $-0.01$ & $-0.05$ \\\\ \nturnovers & $0.27$ & $-0.01$ & $-0.01$ & $-0.29$ \\\\ \nclearances & $0.23$ & $0.00$ & $-0.29$ & $0.19$ \\\\ \nclangers & $0.23$ & $-0.02$ & $-0.06$ & $-0.33$ \\\\ \nhandballs & $0.23$ & $-0.04$ & $-0.19$ & $0.31$ \\\\ \nfrees\\_for & $0.21$ & $0.02$ & $-0.13$ & $0.18$ \\\\ \nmarks & $0.21$ & $0.03$ & $0.32$ & $0.02$ \\\\ \ntackles & $0.20$ & $0.01$ & $-0.28$ & $0.09$ \\\\ \ntime\\_pct & $0.16$ & $-0.04$ & $0.35$ & $-0.02$ \\\\ \nintercepts & $0.13$ & $-0.28$ & $0.24$ & $0.03$ \\\\ \nrebounds\\_in50 & $0.13$ & $-0.28$ & $0.24$ & $-0.06$ \\\\ \nfrees\\_against & $0.13$ & $0.03$ & $-0.16$ & $-0.23$ \\\\ \nassists & $0.09$ & $0.23$ & $0.00$ & $0.05$ \\\\ \nbounces & $0.09$ & $0.03$ & $0.02$ & $-0.28$ \\\\ \nbehinds & $0.09$ & $0.32$ & $0.08$ & $-0.02$ \\\\ \nshots & $0.08$ & $0.38$ & $0.12$ & $-0.03$ \\\\ \ntackles\\_in50 & $0.07$ & $0.27$ & $-0.18$ & $0.03$ \\\\ \nmarks\\_in50 & $0.06$ & $0.34$ & $0.18$ & $0.04$ \\\\ \ncontested\\_marks & $0.05$ & $0.16$ & $0.34$ & $0.15$ \\\\ \ngoals & $0.04$ & $0.37$ & $0.16$ & $0.03$ \\\\ \naccuracy & $0.04$ & $0.34$ & $0.10$ & $0.06$ \\\\ \none\\_pct & $0.03$ & $-0.21$ & $0.33$ & $0.08$ \\\\ \ndisposal & $0.02$ & $-0.13$ & $0.20$ & $0.50$ \\\\ \nhitouts & $-0.04$ & $0.00$ & $-0.03$ & $0.32$ \\\\ \n\\bottomrule\n\\end{longtable}\n\n:::\n:::\n\n\n\nWhen there are as many variables as this, it can be hard to digest the combinations of variables most contributing to each PC. Rearranging the table by sorting on a selected PC can help. @tbl-aflw-pcs has been sorted according to the PC 1 coefficients.\n\nPC 1 is primarily composed of `disposals`, `possessions`, `kicks`, `metres`, `uncontested`, `contested`, .... Actually almost all variables positively contribute, albeit in different amounts! It is quite common in PCA for the first PC to be a combination of all variables, although it might commonly be a closer to equal contribution, and it tells us that there is one main direction of variation in the data. For PC 1 in the `aflw` data, PCA is telling us that the primary variation is through a combination of skills, and this maps to basic football playing skills, where some skills (e.g. disposals, possessions, kicks, ...) are more important.\n\nThus the second PC might be the more interesting. PC 2 is primarily a combination of `shots`, `goals`, `marks_in50`, `accuracy`, and `behinds` contrasted against `rebounds_in50` and `intercepts`. The negative coefficients are primary offensive skills and the positive coefficients are defensive skills. This PC is reasonable measure of the offensive vs defensive skills of a player.\n\nWe would continue to interpret each PC by examining large coefficients to help decide how many PCs are a suitable summary of the information in the data. Briefly, PC 3 is a measure of worth of the player because `time_pct` has a large coefficient, so players that are on the field longer will contribute strongly to this new variable. It also has large (and opposite) contributions from `clearances`, `tackles`, `contested_marks`. PC 4 appears to be related to aggressive play with `clangers`, `turnovers`, `bounces` and `frees_against` featuring. So all four PCs have useful information. (Note, if we had continued to examine large coefficients on PC 5 we would find that all variables already have had reasonably large coefficients on PC 1-4, which supports restricting attention to the first four.)\n\n<!-- We might then use a PCA tour to examine the reduced dimension data, with the original variable axes. This is high-dimensional version of a 2D biplot, as shown below. -->\n\nIdeally, when we tour the four PCs, we'd like to be able to stop and identify players. This involves creating a pre-computed animation, with additional mouse-over. This is only feasible with a small number of observations, like the `aflw` data, because all of the animation frames are constructed in a single object and passed to `plotly`. This object gets large very quickly!\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Code to make tour animation\"}\nlibrary(plotly)\nlibrary(htmlwidgets)\nset.seed(20)\nb <- basis_random(4, 2)\naflw_pct <- tourr::save_history(aflw_pca$x[,1:4], \n                    tour_path = grand_tour(),\n                    start = b,\n                    max_bases = 5)\n# To reconstruct projected data plots, later\nsave(aflw_pct, file=\"data/aflw_pct.rda\") \naflw_pcti <- interpolate(aflw_pct, 0.1)\naflw_anim <- render_anim(aflw_pca$x[,1:4],\n                         frames=aflw_pcti, \n             obs_labels=paste0(aflw$surname,\n                               aflw$given_name))\n\naflw_gp <- ggplot() +\n     geom_path(data=aflw_anim$circle, \n               aes(x=c1, y=c2,\n                   frame=frame), linewidth=0.1) +\n     geom_segment(data=aflw_anim$axes, \n                  aes(x=x1, y=y1, \n                      xend=x2, yend=y2, \n                      frame=frame), \n                  linewidth=0.1) +\n     geom_text(data=aflw_anim$axes, \n               aes(x=x2, y=y2, \n                   frame=frame, \n                   label=axis_labels), \n               size=5) +\n     geom_point(data=aflw_anim$frames, \n                aes(x=P1, y=P2, \n                    frame=frame, \n                    label=obs_labels), \n                alpha=0.8) +\n     xlim(-1,1) + ylim(-1,1) +\n     coord_equal() +\n     theme_bw() +\n     theme(axis.text=element_blank(),\n         axis.title=element_blank(),\n         axis.ticks=element_blank(),\n         panel.grid=element_blank())\naflw_pctour <- ggplotly(aflw_gp,\n                        width=500,\n                        height=550) %>%\n       animation_button(label=\"Go\") %>%\n       animation_slider(len=0.8, x=0.5,\n                        xanchor=\"center\") %>%\n       animation_opts(easing=\"linear\", transition = 0)\n\nhtmlwidgets::saveWidget(aflw_pctour,\n          file=\"html/aflw_pca.html\",\n          selfcontained = TRUE)\n```\n:::\n\n\n\n::: {.content-visible when-format=\"html\"}\n::: {#fig-aflw-pcatour}\n\n<iframe width=\"750\" height=\"550\" src=\"html/aflw_pca.html\" title=\"Animation of four PCs of the aflw data with interactive labelling. \"></iframe>\n\nAnimation of four PCs of the aflw data with interactive labelling.\n:::\n:::\n\n\n\n::: {.cell}\n\n:::\n\n\n\n::: {.content-visible when-format=\"html\"}\nFrom @fig-aflw-pcatour the shape of the four PCs is similar to that of all the variables, bunching of points in the centre with a lot of moderate outliers.\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Code to generate interactive plot of frame 18\"}\nlibrary(plotly)\nload(\"data/aflw_pct.rda\")\naflw_pcti <- interpolate(aflw_pct, 0.1)\nf18 <- matrix(aflw_pcti[,,18], ncol=2)\np18 <- render_proj(aflw_pca$x[,1:4], f18, \n                   obs_labels=paste0(aflw$surname,\n                               aflw$given_name))\npg18 <- ggplot() +\n  geom_path(data=p18$circle, aes(x=c1, y=c2)) +\n  geom_segment(data=p18$axes, aes(x=x1, y=y1, xend=x2, yend=y2)) +\n  geom_text(data=p18$axes, aes(x=x2, y=y2, label=rownames(p18$axes))) +\n  geom_point(data=p18$data_prj, aes(x=P1, y=P2, label=obs_labels)) +\n  xlim(-1,1) + ylim(-1, 1) +\n  #ggtitle(\"Frame 18\") +\n  theme_bw() +\n  theme(\n    axis.text=element_blank(),\n    axis.title=element_blank(),\n    axis.ticks=element_blank(),\n    panel.grid=element_blank())\nggplotly(pg18, width=500, height=500)\n```\n:::\n\n\n\n::: {.content-visible when-format=\"html\"}\nFor any particular frame, like 18 re-plotted in @fig-aflw-pcaplots, we can investigate further. Here there is a branching pattern, where the branch points in the direction of PC 1. Mouse-over the players at the tip of this branch and we find players like Alyce Parker, Brittany Bonnici, Dana Hooker, Kiara Bowers. If you look up the bios of these players you'll find they all have generally good player descriptions like \"elite disposals\", \"powerful left foot\", \"hard-running midfielder\", \"best and fairest\".\n:::\n\nIn the direction of PC 2, you'll find players like Lauren Ahrens, Stacey Livingstone who are star defenders. Players in this end of PC 1, have high scores on `intercepts` and `rebounds_in50`.\n\nAnother interesting frame for inspecting PC 2 is 59. PC 2 at one end has players with high goal scoring skills, and the other good defending skills. So mousing over the other end of PC 2 finds players like Gemma Houghton and Katie Brennan who are known for their goal scoring. The branch pattern is an interesting one, because it tells us there is some combination of skills that are lacking among all players, primarily this appears to be there some distinction between defenders skills and general playing skills. It's not as simple as this because the branching is only visible when PC 1 and PC 2 are examined with PC 3.\n\nPCA is useful for getting a sense of the variation in a high-dimensional data set. Interpreting the principal components is often useful, but it can be discombobulating. For the `aflw` data it would be good to think about it as a guide to the main directions of variation and to follow with a more direct engineering of variables into interesting player characteristics. For example, calculate offensive skill as an equal combination of goals, accuracy, shots, behinds. A set of new variables specifically computed to measure particular skills would make explaining an analysis easier.\n\n::: {.content-visible when-format=\"html\"}\n::: insight\nThe tour verifies that PCA on the `aflw` data is complicated and doesn't capture all of the variation. However, it does provide useful insights. It detected outstanding players, and indicated the different skills sets of top goal scorers and top defensive players.\n:::\n:::\n\n::: {.content-visible when-format=\"pdf\"}\n\\insightbox{The tour verifies that PCA on the `aflw` data is complicated and doesn't capture all of the variation. However, it does provide useful insights. It detected outstanding players, and indicated the different skills sets of top goal scorers and top defensive players.}\n:::\n\n## Examining the PCA model in the data space\n\nWhen you choose a smaller number of PCs $(k)$ than the number of original variables, this is essentially producing a model for the data. The model is the lower dimensional $k$-D space. It is analogous to a linear regression model, except that the residuals from the model are $(p-k)$-D. \n\nIt is common to show the model, that is the data projected into the $k$-D model space. When $k=2$ this is called a \"biplot\". For the `plane` and `plane_noise` data the biplots are shown in @fig-plane-biplot. This is useful for checking which variables contribute most to the new principal component variables, and also to check for any problems that might have affected the fit, such as outliers, clusters or non-linearity. Interestingly, biplots are typically only made in 2D, even if the data should be summarised by more than two PCs. Occasionally you will see the biplot made for PC $j$ vs PC $k$ also. With the `pca_tour()` function in the `tourr` package you can view a $k$-D biplot. This will display the $k$ PCs with the axes displaying the original variables, and thus see their contribution to the PCs. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(ggfortify)\nlibrary(patchwork)\nplane_pca <- prcomp(plane)\npl1 <- autoplot(plane_pca, loadings = TRUE, \n         loadings.label = TRUE) + \n  ggtitle(\"(a)\") +\n  theme_minimal() + \n  theme(aspect.ratio=1)\nplane_noise_pca <- prcomp(plane_noise)\npl2 <- autoplot(plane_noise_pca, loadings = TRUE, \n         loadings.label = TRUE) + \n  ggtitle(\"(b)\") +\n  theme_minimal() + \n  theme(aspect.ratio=1)\npl1 + pl2\n```\n\n::: {.cell-output-display}\n![Biplots of the plane (a) and plane + noise (b) data. All five variables contribute strongly to the two principal components in (a): PC1 is primarily `x1`, `x2` and `x3` and PC2 is primarily `x4` and `x5`. In (b) the same four variables contribute in almost the same way, with variables `x6` and `x7` contributing very little. The data was constructed this way, that these two dimensions were purely noise.](4-pca_files/figure-pdf/fig-plane-biplot-1.pdf){#fig-plane-biplot fig-pos='H' width=80%}\n:::\n:::\n\n\n\n\nIt can be useful to examine this model using the tour. The model is simply a plane in high dimensions. This would be considered to be the model in the data space. The reason to do this is to check how well the model fits the data. The plane corresponding to the model should be oriented along the main direction of the points, and the spread of points around the plane should be small. We should also be able to see if there has been any strong non-linear relationship missed by the model, or outliers and clusters.\n\nThe function `pca_model()` from the `mulgar` package can be used to represent the model as a $k$-D wire-frame plane. @fig-plane-box-model-pdf shows the models for the `plane` and `box` data, 2D and 3D respectively.\n\n::: {.content-visible when-format=\"html\"}\n::: info\nWe look at the model in the data space to check how well the model fits the data. If it fits well, the points will cluster tightly around the model representation, with little spread in other directions.\n:::\n:::\n\n::: {.content-visible when-format=\"pdf\"}\n\\infobox{We look at the model in the data space to check how well the model fits the data. If it fits well, the points will cluster tightly around the model representation, with little spread in other directions.}\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nplane_m <- pca_model(plane_pca)\nplane_m_d <- rbind(plane_m$points, plane)\nanimate_xy(plane_m_d, edges=plane_m$edges,\n           axes=\"bottomleft\",\n           edges.col=\"#E7950F\",\n           edges.width=3)\nrender_gif(plane_m_d, \n           grand_tour(), \n           display_xy(half_range=0.9,\n                      edges=plane_m$edges, \n                      edges.col=\"#E7950F\",\n                      edges.width=3),\n           gif_file=\"gifs/plane_model.gif\",\n           frames=500,\n           width=400,\n           height=400,\n           loop=FALSE)\nbox_pca <- prcomp(box)\nbox_m <- pca_model(box_pca, d=3)\nbox_m_d <- rbind(box_m$points, box)\nanimate_xy(box_m_d, edges=box_m$edges, \n           axes=\"bottomleft\", edges.col=\"#E7950F\", edges.width=3)\nrender_gif(box_m_d, \n           grand_tour(), \n           display_xy(half_range=0.9,\n                      edges=box_m$edges, \n                      edges.col=\"#E7950F\",\n                      edges.width=3),\n           gif_file=\"gifs/box_model.gif\",\n           frames=500,\n           width=400,\n           height=400,\n           loop=FALSE)\n```\n:::\n\n\n\n\n::: {.content-visible when-format=\"html\"}\n::: {#fig-plane-box-model-html  fig-align=\"center\" layout-ncol=2}\n\n![Model for the 2D in 5D data.](gifs/plane_model.gif){#fig-plane-model fig-alt=\"FIX ME.\" fig.align=\"center\"}\n\n![Model for the 3D in 5D data.](gifs/box_model.gif){#fig-box-model fig-alt=\"FIX ME.\" fig.align=\"center\"}\n\nPCA model overlaid on the data for the 2D in 5D, and 3D in 5D simulated data. \n:::\n:::\n\n::: {.content-visible when-format=\"pdf\"}\n::: {#fig-plane-box-model-pdf  fig-align=\"center\" layout-ncol=2}\n\n![Model for the 2D in 5D data.](images/plane_model_55.png){#fig-plane-model fig-alt=\"FIX ME.\" fig.align=\"center\"}\n\n![Model for the 3D in 5D data.](images/box_model_13.png){#fig-box-model fig-alt=\"FIX ME.\" fig.align=\"center\"}\n\nPCA model overlaid on the data for the 2D in 5D, and 3D in 5D simulated data. \n:::\n:::\n\n### Example: pisa\n\nThe model for the `pisa` data is a 1D vector, shown in @fig-pisa-model-pdf. \n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\npisa_model <- pca_model(pisa_pca, d=1, s=2)\n\npisa_all <- rbind(pisa_model$points, pisa_std)\nanimate_xy(pisa_all, edges=pisa_model$edges,\n           edges.col=\"#E7950F\", edges.width=3)\nrender_gif(pisa_all, \n           grand_tour(), \n           display_xy(half_range=0.9,\n                      edges=pisa_model$edges, \n                      edges.col=\"#E7950F\", \n                      edges.width=5),\n           gif_file=\"gifs/pisa_model.gif\",\n           frames=500,\n           width=400,\n           height=400,\n           loop=FALSE)\n```\n:::\n\n\n\n::: {.content-visible when-format=\"html\"}\n::: {#fig-pisa-model-html}\n\n![](gifs/pisa_model.gif){fig-alt=\"Something here\" fig.align=\"center\"}\n\nPCA model of the `pisa` data. The 1D model captures the primary variation in the data and there is a small amount of spread in all directions away from the model. \n:::\n:::\n\n::: {.content-visible when-format=\"pdf\"}\n::: {#fig-pisa-model-pdf fig-alt=\"Something here\" fig.align=\"center\"}\n\n![](images/pisa_model_17.png){}\n\nPCA model of the `pisa` data. The 1D model captures the primary variation in the data and there is a small amount of spread in all directions away from the model. \n:::\n:::\n\n::: {.content-visible when-format=\"html\"}\n::: insight\nThe `pisa` data fits fairly closely to the 1D PCA model. The variance of points away from the model is symmetric and relatively small. These suggest the 1D model is a reasonably summary of the test scores.\n:::\n:::\n\n::: {.content-visible when-format=\"html\"}\n\\insightbox{The `pisa` data fits fairly closely to the 1D PCA model. The variance of points away from the model is symmetric and relatively small. These suggest the 1D model is a reasonably summary of the test scores.}\n:::\n\n### Example: aflw\n\nIt is less useful to examine the PCA model for the `aflw` data, because the main patterns that were of interest were the exceptional players. However, we will do it anyway! @fig-aflw-model-pdf shows the 4D PCA model overlain on the data. Even though the distribution of points is not as symmetric and balanced as the other examples, we can see that the cube structure mirrors the variation. We can see that the relationships between variables are not strictly linear, because the spread extends unevenly away from the box. \n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\naflw_model <- pca_model(aflw_pca, d=4, s=1)\n\naflw_all <- rbind(aflw_model$points, aflw_std[,7:35])\nanimate_xy(aflw_all, edges=aflw_model$edges,\n           edges.col=\"#E7950F\", \n           edges.width=3, \n           half_range=0.8, \n           axes=\"off\")\nrender_gif(aflw_all, \n           grand_tour(), \n           display_xy(half_range=0.8,\n                      edges=aflw_model$edges, \n                      edges.col=\"#E7950F\", \n                      edges.width=3, \n                      axes=\"off\"),\n           gif_file=\"gifs/aflw_model.gif\",\n           frames=500,\n           width=400,\n           height=400,\n           loop=FALSE)\n```\n:::\n\n\n\n::: {.content-visible when-format=\"html\"}\n::: {#fig-aflw-model-html}\n\n![](gifs/aflw_model.gif){ fig-alt=\"Something here\" fig.align=\"center\"}\n\nPCA model of the `aflw` data. The linear model is not ideal for this data, which has other patterns like outliers, and some branching. However, the model roughly captures the linear associations, and leaves unequal variation in different directions.\n:::\n:::\n\n::: {.content-visible when-format=\"pdf\"}\n::: {#fig-aflw-model-pdf  fig-alt=\"Something here\" fig.align=\"center\"}\n\n![](images/aflw_model_70.png){}\n\nPCA model of the `aflw` data. The linear model is not ideal for this data, which has other patterns like outliers, and some branching. However, the model roughly captures the linear associations, and leaves unequal variation in different directions.\n:::\n:::\n\n::: {.content-visible when-format=\"html\"}\n::: insight\nFrom the tour we see that the 4D model leaves substantial variation unexplained. It is also not symmetric, and there is some larger variation away from the model in some combinations of variables than others. \n:::\n:::\n\n::: {.content-visible when-format=\"pdf\"}\n\\insightbox{From the tour we see that the 4D model leaves substantial variation unexplained. It is also not symmetric, and there is some larger variation away from the model in some combinations of variables than others.}\n:::\n\n## When relationships are not linear \n\n### Example: outliers\n\n@fig-plane-n-o-scree shows the scree plot for the planar data with noise and outliers. It is very similar to the scree plot on the data without the outliers (@fig-plane-noise-scree). However, what we see from @fig-p-o-pca-pdf is that PCA loses the outliers. The animation in (a) shows the full data, and the outliers marked by colour and labels 1, 2, are clearly unusual in some projections. When we examine the tour of the first four PCs (as suggested by the scree plot) the outliers are not unusual. They are almost contained in the point cloud. The reason is clear when all the PCs are plotted, and the outliers can be seen to be clearly detected only in PC5, PC6 and PC7. \n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nplane_n_o_pca <- prcomp(plane_noise_outliers)\nggscree(plane_n_o_pca, q = 7) + theme_minimal()\n```\n\n::: {.cell-output-display}\n![Scree plot of the planar data with noise and an outlier. It is almost the same as the data without the outliers.](4-pca_files/figure-pdf/fig-plane-n-o-scree-1.pdf){#fig-plane-n-o-scree fig-pos='H' width=80%}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nclrs <- hcl.colors(12, \"Zissou 1\")\np_col <- c(rep(\"black\", 100), clrs[11], clrs[11])\np_obs_labels <- c(rep(\"\", 100), \"1\", \"2\")\n\nanimate_xy(plane_n_o_pca$x[,1:4],\n           col=p_col,\n           obs_labels=p_obs_labels)\nanimate_xy(plane_noise_outliers,\n           col=p_col,\n           obs_labels=p_obs_labels)\nrender_gif(plane_noise_outliers, \n           grand_tour(), \n           display_xy(half_range=0.8,\n                      col=p_col,\n             obs_labels=p_obs_labels),\n           gif_file=\"gifs/plane_n_o_clr.gif\",\n           frames=500,\n           width=200,\n           height=200,\n           loop=FALSE)\nrender_gif(plane_n_o_pca$x[,1:4], \n           grand_tour(), \n           display_xy(half_range=0.8,\n                      col=p_col,\n             obs_labels=p_obs_labels),\n           gif_file=\"gifs/plane_n_o_pca.gif\",\n           frames=500,\n           width=200,\n           height=200,\n           loop=FALSE)\n```\n:::\n\n\n\n::: {.content-visible when-format=\"html\"}\n::: {#fig-p-o-pca-html fig-align=\"center\" layout-ncol=2}\n\n![Outliers clearly visible.](gifs/plane_n_o_clr.gif){#fig-plane-n-o-clr width=250}\n\n![Outliers not clearly visible in PC1-4.](gifs/plane_n_o_pca.gif){#fig-plane-n-o-pca width=250}\n\nExamining the handling of outliers in the PCA of the planar data with noise variables and two outliers. PCA has lost these two extreme values.\n:::\n:::\n\n::: {.content-visible when-format=\"pdf\"}\n::: {#fig-p-o-pca-pdf fig-align=\"center\" layout-ncol=2}\n\n![Outliers clearly visible.](images/plane_n_o_clr_181.png){#fig-plane-n-o-clr width=250}\n\n![Outliers not clearly visible in PC1-4.](images/plane_n_o_pca_181.png){#fig-plane-n-o-pca width=250}\n\nExamining the handling of outliers in the PCA of the planar data with noise variables and two outliers. PCA has lost these two extreme values.\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Code to make scatterplot matrix\"}\nlibrary(GGally)\nggscatmat(plane_n_o_pca$x) + theme_minimal()\n```\n\n::: {.cell-output-display}\n![From the scatterplot matrix we can see that the outliers are present in PC5, PC6 and PC7. That means by reducing the dimensionality to the first four PCs the model has missed some important characteristics in the data.](4-pca_files/figure-pdf/fig-plane-o-n-pairs-1.pdf){#fig-plane-o-n-pairs fig-pos='H' width=80%}\n:::\n:::\n\n\n\n### Example: Non-linear associations\n\n@fig-plane-nonlin-pdf shows the tour of the full 5D data containing non-linear relationships in comparison with a tour of the first three PCs, as recommended by the scree plot (@fig-plane-nonlin-scree). The PCs capture some clear and very clean non-linear relationship, but it looks like it has missed some of the complexities of the relationships. The scatterplot matrix of all 5 PCs (@fig-plane-nonlin-pairs) shows that PC4 and PC5 contain interesting features: more non-linearity, and curiously an outlier.\n \n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\ndata(plane_nonlin)\nplane_nonlin_pca <- prcomp(plane_nonlin)\nggscree(plane_nonlin_pca, q = 5) + theme_minimal()\n```\n\n::: {.cell-output-display}\n![Scree plot of the non-linear data suggests three PCs.](4-pca_files/figure-pdf/fig-plane-nonlin-scree-1.pdf){#fig-plane-nonlin-scree fig-pos='H' width=80%}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Code to generate tour\"}\nanimate_xy(plane_nonlin_pca$x[,1:3])\nrender_gif(plane_nonlin_pca$x[,1:3], \n           grand_tour(), \n           display_xy(half_range=0.8),\n           gif_file=\"gifs/plane_nonlin_pca.gif\",\n           frames=500,\n           width=200,\n           height=200)\n```\n:::\n\n\n\n::: {.content-visible when-format=\"html\"}\n::: {#fig-plane-nonlin-html fig-align=\"center\" layout-ncol=2}\n\n![Non-linear relationship between several variables seen in a tour on all five variables.](gifs/plane_nonlin.gif){#fig-nonlinear2  width=250}\n\n![The first three principal components reveal a strong non-linear relationship.](gifs/plane_nonlin_pca.gif){#fig-plane-nonlin-pca width=250}\n\nComparison of the full data and first three principal components. Some of the non-linearity is clearly visible in the reduced dimension space, but the full data has more complexities.\n:::\n:::\n\n::: {.content-visible when-format=\"pdf\"}\n::: {#fig-plane-nonlin-pdf fig-align=\"center\" layout-ncol=2}\n\n![Non-linear relationship between several variables seen in a tour on all five variables.](images/plane_nonlin_61.png){#fig-nonlinear2  width=250}\n\n![The first three principal components reveal a strong non-linear relationship.](images/plane_nonlin_pca_129.png){#fig-plane-nonlin-pca width=250}\n\nComparison of the full data and first three principal components. Some of the non-linearity is clearly visible in the reduced dimension space, but the full data has more complexities.\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Code to make scatterplot matrix\"}\nggscatmat(plane_nonlin_pca$x)\n```\n\n::: {.cell-output-display}\n![From the scatterplot matrix we can see that the there is a non-linear relationship visible in PC1 and PC2, with perhaps a small contribution from PC3. However, we can see that when the data is reduced to three PCs, it misses catching all on the non-linear relationships and also interestingly it seems that there is an unusual observation also.](4-pca_files/figure-pdf/fig-plane-nonlin-pairs-1.pdf){#fig-plane-nonlin-pairs fig-pos='H' width=80%}\n:::\n:::\n\n\n\n::: {.content-visible when-format=\"html\"}\n::: info\nOne of the dangers of PCA is that interesting and curious details of the data only emerge in the lowest PCs, that are usually discarded. The tour, and examining the smaller PCs, can help to discover them.\n:::\n:::\n\n::: {.content-visible when-format=\"pdf\"}\n\\infobox{One of the dangers of PCA is that interesting and curious details of the data only emerge in the lowest PCs, that are usually discarded. The tour, and examining the smaller PCs, can help to discover them.}\n:::\n\n## Exercises {-}\n\n1.  Make a scatterplot matrix of the first four PCs of the `aflw` data. Is the branch pattern visible in any pair?\n2.  Construct five new variables to measure these skills offense, defense, playing time, ball movement, errors. Using the tour, examine the relationship between these variables. Map out how a few players could be characterised based on these directions of skills.\n3. Symmetrise any `aflw` variables that have skewed distributions using a log or square root transformation. Then re-do the PCA. What do we learn that is different about associations between the skill variables?\n4. Examine the `bushfires` data using a grand tour on the numeric variables, ignoring the `cause` (class) variable. Note any issues such as outliers, or skewness that might affect PCA. How many principal components would be recommended by the scree plot? Examine this PCA model with the data, and explain how well it does or doesn't fit.\n5. Use the `pca_tour` to examine the first five PCs of the `bushfires` data. How do all of the variables contribute to this reduced space?\n6. Reduce the dimension of the `sketches` data to 12 PCs. How much variation does this explain? Is there any obvious clustering in this lower dimensional space?\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\n## Project {-}\n\nLinear dimension reduction can optimise for other criteria, and here we will explore one example: the algorithm implemented in the `dobin` package finds a basis in which the first few directions are optimized for the detection of outliers in the data. We will examine how it performs for the `plane_noise_outliers` data (the example where outliers were hidden in the first four principal components.)\n\n1. Start by looking up the documentation of `dobin::dobin`. How many parameters does the method depend on?\n2. We first apply the function to the `plane_noise_outliers` data using default values for all parameters.\n3. Recall that the outliers were added in rows 101 and 102 of the data. Make a scatter plots showing the projection onto the first, second and third component, using color to highlight the outliers. Are they visible as outliers with three components?\n4. Adjust the `frac` parameter of the `dobin` function to `frac = 0.99` and repeat the graphical evaluation from point 3. How does it compare to the previous solution?\n\n\n\n::: {.cell}\n\n:::\n",
    "supporting": [
      "4-pca_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{\"knit_meta_id\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"tbl-plane-pcs\",\"tbl-plane-pcs\",\"tbl-plane-pcs\",\"tbl-box-pcs\",\"tbl-box-pcs\",\"tbl-box-pcs\",\"tbl-plane-noise-pcs\",\"tbl-plane-noise-pcs\",\"tbl-plane-noise-pcs\",\"tbl-aflw-pcs\",\"tbl-aflw-pcs\",\"tbl-aflw-pcs\"]}},\"value\":[{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"caption\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"caption\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"caption\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"caption\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]}]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}