{
  "hash": "05884bf473d446af97b5d4ab51be7d64",
  "result": {
    "engine": "knitr",
    "markdown": "# Exploring misclassifications\n\\index{classification!misclassification}\n\n## Errors for a single model\n\nTo examine misclassifications, we can create a separate variable that identifies the errors or not. Constructing this for each class, and exploring in small steps is helpful. Let's do this using the random forest model for the penguins fit. The random forest fit has only a few misclassifications. There are four Adelie penguins confused with Chinstrap, and similarly four Chinstrap confused with Adelie. There is one Gentoo penguin confused with a Chinstrap. This is interesting, because the Gentoo cluster is well separated from the clusters of the other two penguin species. \n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Code to fit forest\"}\nlibrary(randomForest)\nlibrary(dplyr)\nload(\"data/penguins_sub.rda\")\n\npenguins_rf <- randomForest(species~.,\n                             data=penguins_sub[,1:5],\n                             importance=TRUE)\n```\n:::\n\n\n\n\n\n\\index{classification!confusion matrix}\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\npenguins_rf$confusion\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          Adelie Chinstrap Gentoo class.error\nAdelie       143         3      0 0.020547945\nChinstrap      4        64      0 0.058823529\nGentoo         0         1    118 0.008403361\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\npenguins_errors <- penguins_sub %>%\n  mutate(err = ifelse(penguins_rf$predicted !=\n                        penguins_rf$y, 1, 0))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Code to make animated gifs\"}\nlibrary(tourr)\nsymbols <- c(1, 16)\np_pch <- symbols[penguins_errors$err+1]\np_cex <- rep(1, length(p_pch))\np_cex[penguins_errors$err==1] <- 2\nanimate_xy(penguins_errors[,1:4],\n           col=penguins_errors$species,\n           pch=p_pch, cex=p_cex)\nrender_gif(penguins_errors[,1:4],\n           grand_tour(),\n           display_xy(col=penguins_errors$species,\n                      pch=p_pch, cex=p_cex),\n           gif_file=\"gifs/p_rf_errors.gif\",\n           frames=500,\n           width=400,\n           height=400)\n\nanimate_xy(penguins_errors[,1:4],\n           guided_tour(lda_pp(penguins_errors$species)),\n           col=penguins_errors$species,\n           pch=pch)\n\nrender_gif(penguins_errors[,1:4],\n           guided_tour(lda_pp(penguins_errors$species)),\n           display_xy(col=penguins_errors$species,\n                      pch=p_pch, cex=p_cex),\n           gif_file=\"gifs/p_rf_errors_guided.gif\",\n           frames=500,\n           width=400,\n           height=400,\n           loop=FALSE)\n```\n:::\n\n\n\n\n\n\n@fig-p-errors-html shows a grand tour, and a guided tour, of the penguins data, where the misclassifications are marked by an asterisk. (If the gifs are too small to see the different glyphs, you can zoom in to make the figures larger.) It can be seen that the one Gentoo penguin that is mistaken for a Chinstrap by the forest model is always moving with its other Gentoo (yellow) family. It can occasionally be seen to be on the edge of the group, closer to the Chinstraps, in some projections in the grand tour. But in the final projection from the guided tour it is hiding well among the other Gentoos. This is an observation where a mistake has been made because of the inadequacies of the forest algorithm. Forests are only as good as the trees they are constructed from, and we have seen from @sec-trees that the splits only on single variables done by trees does not adequately utilise the covariance structure in each class. They make mistakes based on the boxy nature of the boundaries. This can carry through to the forests model. Even though many trees are combined to generate smoother boundaries, forests do not effectively utilise covariance in clusters either. The other mistakes, where Chinstrap are predicted to be Adelie, and vice versa, are more sensible. These mistaken observations can be seen to lie in the border region between the two clusters, and reflect genuine uncertainty about the classification of penguins in these two species.\n\n::: {.content-visible when-format=\"html\"}\n::: {#fig-p-errors-html layout-ncol=2}\n\n![Grand tour](gifs/p_rf_errors.gif){#fig-rf-errors fig-alt=\"FIX ME\" width=300}\n\n![Guided tour](gifs/p_rf_errors_guided.gif){#fig-rf-errors-guided fig-alt=\"FIX ME\" width=300}\n\nExamining the misclassified cases (marked as solid circles) from a random forest fit to the penguins data. The one Gentoo penguin mistaken for a Chinstrap is a mistake made because the forest method suffers from the same problems as trees - cutting on single variables rather than effectively using covariance structure. The mistakes between the Adelie and Chinstrap penguins are more sensible because all of these observations lie is the bordering regions between the two clusters.\n:::\n:::\n\n::: {.content-visible when-format=\"pdf\"}\n::: {#fig-p-errors-pdf layout-ncol=2}\n\n![Grand tour](images/p_rf_errors.png){#fig-rf-errors fig-alt=\"FIX ME\" width=200}\n\n![Guided tour](images/p_rf_errors_guided.png){#fig-rf-errors-guided fig-alt=\"FIX ME\" width=200}\n\nExamining the misclassified cases (marked as asterisks) from a random forest fit to the penguins data. The one Gentoo penguin mistaken for a Chinstrap is a mistake made because the forest method suffers from the same problems as trees - cutting on single variables rather than effectively using covariance structure. The mistakes between the Adelie and Chinstrap penguins are more sensible because all of these observations lie is the bordering regions between the two clusters.\n:::\n:::\n\n::: {.content-visible when-format=\"html\"}\n::: info\nSome errors are reasonable because there is overlap between the class clusters. Some errors are not reasonable because the model used is inadequate.\n:::\n:::\n\n::: {.content-visible when-format=\"pdf\"}\n\\infobox{Some errors are reasonable because there is overlap between the class clusters. Some errors are not reasonable because the model used is inadequate.\n}\n:::\n\n## Comparison between LDA and CNN\n\n## Constructing data to diagnose your model\n\n## Explainability\n\n## Exercises {-}\n\n1. Examine misclassifications from a random forest model for the fake_trees data between cluster 1 and 0, using the \n    a. principal components\n    b. votes matrix. \nDescribe where these errors relative to their true and predicted class clusters. When examining the simplex, are the misclassifications the points that are furthest from any vertices?\n2. Examine the misclassifications for the random forest model on the sketches data, focusing on cactus sketches that were mistaken for bananas. Follow up by plotting the images of these errors, and describe whether the classifier is correct that these sketches are so poor their true cactus or banana identity cannot be determined. \n3. How do the errors from the random forest model compare with those of your best fitting CNN model? Are the the corresponding images poor sketches of cacti or bananas?\n4. Now examine the misclassifications of the sketches data in the \n    a. votes matrix from the random forest model\n    b. predictive probability distribution from the CNN model,\nusing the simplex approach. Are they as expected, points lying in the middle or along an edge of the simplex?\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}