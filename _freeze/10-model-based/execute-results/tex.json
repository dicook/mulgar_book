{
  "hash": "406f8f0959e454d38e6b14120b705ded",
  "result": {
    "engine": "knitr",
    "markdown": "# Model-based clustering {#sec-mclust}\n\n\\index{cluster analysis!model-based} \n\nModel-based clustering @FR02 fits a multivariate normal mixture model to the data. It uses the EM algorithm to fit the parameters for the mean, variance--covariance of each population, and the mixing proportion. The variance-covariance matrix is re-parameterised using an eigen-decomposition\n\n$$\n\\Sigma_k = \\lambda_kD_kA_kD_k^\\top, ~~~k=1, \\dots, g ~~\\mbox{(number of clusters)}\n$$\n\n\\noindent resulting in several model choices, ranging from simple to complex, as shown in @tbl-covariances.\n\n\n\n::: {.cell}\n\n:::\n\n::: {#tbl-covariances .cell tbl-cap='Parameterizations of the covariance matrix.'}\n::: {.cell-output-display}\n\\begin{table}\n\\centering\n\\begin{tabular}{c|c|c|c|c|c}\n\\hline\nModel & Sigma & Family & Volume & Shape & Orientation\\\\\n\\hline\nEII & \\$\\$\\textbackslash{}lambda I\\$\\$ & Spherical & Equal & Equal & NA\\\\\n\\hline\nVII & \\$\\$\\textbackslash{}lambda\\_k I\\$\\$ & Spherical & Variable & Equal & NA\\\\\n\\hline\nEEI & \\$\\$\\textbackslash{}lambda A\\$\\$ & Diagonal & Equal & Equal & Coordinate axes\\\\\n\\hline\nVEI & \\$\\$\\textbackslash{}lambda\\_kA\\$\\$ & Diagonal & Variable & Equal & Coordinate axes\\\\\n\\hline\nEVI & \\$\\$\\textbackslash{}lambda A\\_k\\$\\$ & Diagonal & Equal & Variable & Coordinate axes\\\\\n\\hline\nVVI & \\$\\$\\textbackslash{}lambda\\_k A\\_k\\$\\$ & Diagonal & Variable & Variable & Coordinate axes\\\\\n\\hline\nEEE & \\$\\$\\textbackslash{}lambda DAD\\textasciicircum{}\\textbackslash{}top\\$\\$ & Diagonal & Equal & Equal & Equal\\\\\n\\hline\nEVE & \\$\\$\\textbackslash{}lambda DA\\_kD\\textasciicircum{}\\textbackslash{}top\\$\\$ & Ellipsoidal & Equal & Variable & Equal\\\\\n\\hline\nVEE & \\$\\$\\textbackslash{}lambda\\_k DAD\\textasciicircum{}\\textbackslash{}top\\$\\$ & Ellipsoidal & Variable & Equal & Equal\\\\\n\\hline\nVVE & \\$\\$\\textbackslash{}lambda\\_k DA\\_kD\\textasciicircum{}\\textbackslash{}top\\$\\$ & Ellipsoidal & Variable & Equal & Equal\\\\\n\\hline\nEEV & \\$\\$\\textbackslash{}lambda D\\_kAD\\_k\\textasciicircum{}\\textbackslash{}top\\$\\$ & Ellipsoidal & Equal & Variable & Variable\\\\\n\\hline\nVEV & \\$\\$\\textbackslash{}lambda\\_k D\\_kAD\\_k\\textasciicircum{}\\textbackslash{}top\\$\\$ & Ellipsoidal & Variable & Variable & Variable\\\\\n\\hline\nEVV & \\$\\$\\textbackslash{}lambda D\\_kA\\_kD\\_k\\textasciicircum{}\\textbackslash{}top\\$\\$ & Ellipsoidal & Equal & Variable & Variable\\\\\n\\hline\nVVV & \\$\\$\\textbackslash{}lambda\\_k D\\_kA\\_kD\\_k\\textasciicircum{}\\textbackslash{}top\\$\\$ & Ellipsoidal & Variable & Variable & Variable\\\\\n\\hline\n\\end{tabular}\n\\end{table}\n\n\n:::\n:::\n\n\n\n\\noindent Note the distribution descriptions \"spherical\" and \"ellipsoidal\". These are descriptions of the shape of the variance-covariance for a multivariate normal distribution. A standard multivariate normal distribution has a variance-covariance matrix with zeros in the off-diagonal elements, which corresponds to spherically shaped data. When the variances (diagonals) are different or the variables are correlated, then the shape of data from a multivariate normal is ellipsoidal.\n\n\\index{Bayes Information Criterion (BIC)}\n\nThe models are typically scored using the Bayes Information Criterion (BIC), which is based on the log likelihood, number of variables, and number of mixture components. They should also be assessed using graphical methods, as we demonstrate using the penguins data. \n\n## Examining the model in 2D\n\nWe start with two of the four real-valued variables (`bl`, `fl`) and the three `species`. The goal is to determine whether model-based methods can discover clusters that closely correspond to the three species. Based on the scatterplot in @fig-penguins-bl-fl we would expect it to do well, and suggest an elliptical variance-covariance of roughly equal sizes as the model.\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Scatterplot of flipper length by bill length of the penguins data.](10-model-based_files/figure-pdf/fig-penguins-bl-fl-1.pdf){#fig-penguins-bl-fl width=80%}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\npenguins_BIC <- mclustBIC(penguins_sub[,c(1,3)])\nggmc <- ggmcbic(penguins_BIC, cl=2:9, top=4) + \n  scale_color_discrete_divergingx(palette = \"Roma\") +\n  ggtitle(\"(a)\") +\n  theme_minimal() \npenguins_mc <- Mclust(penguins_sub[,c(1,3)], \n                      G=3, \n                      modelNames = \"EVE\")\npenguins_mce <- mc_ellipse(penguins_mc)\npenguins_cl <- penguins_sub[,c(1,3)]\npenguins_cl$cl <- factor(penguins_mc$classification)\nggell <- ggplot() +\n   geom_point(data=penguins_cl, aes(x=bl, y=fl,\n                                    colour=cl),\n              alpha=0.3) +\n   geom_point(data=penguins_mce$ell, aes(x=bl, y=fl,\n                                         colour=cl),\n              shape=16) +\n   geom_point(data=penguins_mce$mn, aes(x=bl, y=fl,\n                                        colour=cl),\n              shape=3, size=2) +\n  scale_color_discrete_divergingx(palette = \"Zissou 1\")  +\n  theme_minimal() +\n  theme(aspect.ratio=1, legend.position=\"none\") +\n  ggtitle(\"(b)\")\nggmc + ggell + plot_layout(ncol=2)\n```\n\n::: {.cell-output-display}\n![Summary plots from model-based clustering: (a) BIC values for clusters 2-9 of top four models, (b) variance-covariance ellipses and cluster means (+) corresponding to the best model. The best model is three-cluster EVE, which has differently shaped variance-covariances albeit the same volume and orientation.](10-model-based_files/figure-pdf/fig-penguins-bl-fl-mc-1.pdf){#fig-penguins-bl-fl-mc fig-pos='H' width=100%}\n:::\n:::\n\n\n\n@fig-penguins-bl-fl-mc summarises the results. All models agree that three clusters is the best. The different variance-covariance models for three clusters have similar BIC values with EVE (different shape, same volume and orientation) being slightly higher. These plots are made from the `mclust` package output using the `ggmcbic` and `mc_ellipse` functions fro the `mulgar` package.\n\n## Examining the model in high dimensions\n\nNow we will examine how model-based clustering will group the penguins data using all four variables. @fig-penguins-bic shows the summary of different models, of which we would choose the four-cluster VEE, if we strictly followed the BIC choice. @fig-penguins-mc-pdf shows this model in a tour, and the best three-cluster model. You can see that the four-cluster result is inadequate, in various ways. One of the species (Chinstrap) does have a bimodal density, due to the two species, and we would expect that a four cluster solution might detect this. The tour shows that the three-cluster solution is the best match to the data shape.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"false\"}\npenguins_BIC <- mclustBIC(penguins_sub[,1:4])\nggmc <- ggmcbic(penguins_BIC, cl=2:9, top=7) + \n  scale_color_discrete_divergingx(palette = \"Roma\") +\n  theme_minimal() \nggmc\n```\n\n::: {.cell-output-display}\n![BIC values for the top models for 2-9 clusters on the penguins data. The interpretation is mixed: if one were to choose three clusters any of the variance-covariance models would be equally as good, but the very best model is the four-cluster VEE.](10-model-based_files/figure-pdf/fig-penguins-bic-1.pdf){#fig-penguins-bic fig-align='center' fig-pos='H' width=80%}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\npenguins_mc <- Mclust(penguins_sub[,1:4], \n                      G=4, \n                      modelNames = \"VEE\")\npenguins_mce <- mc_ellipse(penguins_mc)\npenguins_cl <- penguins_sub\npenguins_cl$cl <- factor(penguins_mc$classification)\n\npenguins_mc_data <- penguins_cl %>%\n  select(bl:bm, cl) %>%\n  mutate(type = \"data\") %>%\n  bind_rows(bind_cols(penguins_mce$ell,\n                      type=rep(\"ellipse\",\n                               nrow(penguins_mce$ell)))) %>%\n  mutate(type = factor(type))\n```\n:::\n\n::: {.cell}\n\n:::\n\n\n\n::: {.content-visible when-format=\"html\"}\n::: {#fig-penguins-mc-html layout-ncol=2}\n\n![Four-cluster VEE](gifs/penguins_best_mc.gif){#fig-penguins-best_mc fig-alt=\"FIX ME\" fig.align=\"center\"}\n\n![Three-cluster EEE](gifs/penguins_simpler_mc.gif){#fig-penguins-simpler_mc fig-alt=\"FIX ME\" fig.align=\"center\"}\n\nExamining the model-based clustering results for the penguins data: (a) best model according to BIC value, (b) simpler three-cluster model. Dots are ellipse points, and \"x\" are data points. It is important to note that the three cluster solution fits the data better, even though it has a lower BIC. \n:::\n:::\n\n::: {.content-visible when-format=\"pdf\"}\n::: {#fig-penguins-mc-pdf layout-ncol=2}\n\n![Four-cluster VEE](images/penguins_best_mc_60.png){#fig-penguins-best-mc fig-alt=\"FIX ME\" fig.align=\"center\"}\n\n![Three-cluster EEE](images/penguins_simpler_mc_60.png){#fig-penguins-simpler-mc fig-alt=\"FIX ME\" fig.align=\"center\"}\n\nExamining the model-based clustering results for the penguins data: (a) best model according to BIC value, (b) simpler three-cluster model. Dots are ellipse points, and \"x\" are data points. It is important to note that the three cluster solution fits the data better, even though it has a lower BIC. \n:::\n:::\n\n::: {.content-visible when-format=\"html\"}\n::: info\nUsing the tour to visualise the final choices of models with similarly high BIC values helps to choose which best fits the data. It may not be the one with the highest BIC value. \n:::\n:::\n\n::: {.content-visible when-format=\"pdf\"}\n\\infobox{Using the tour to visualise the final choices of models with similarly high BIC values helps to choose which best fits the data. It may not be the one with the highest BIC value.}\n:::\n\n\n\n::: {.cell}\n\n:::\n\n\n\n## Exercises {-}\n\n1. Examine the three cluster EVE, VVE and VEE models with the tour, and explain whether these are distinguishably different from the EEE three cluster model.\n2. Fit model-based clustering to the the `clusters`. Does it suggest the data has three clusters? Using the tour examine the best model model. How well does this fit the data?\n3. Fit model-based clustering to the the `multicluster`. Does it suggest the data has six clusters? Using the tour examine the best model model. How well does this fit the data?\n4. Fit model-based clustering to the `fake_trees` data. Does it suggest that the data has 10 clusters? If not, why do you think this is?  Using the tour examine the best model model. How well does this fit the branching structure?\n5. Try fitting model-based clustering to the `aflw` data? What is the best model? Is the solution related to offensive vs defensive vs mid-fielder skills?\n6. Use model-based clustering on the challenge data sets, `c1`-`c7` from the `mulgar` package. Explain why or why not the best model fits the cluster structure or not.\n",
    "supporting": [
      "10-model-based_files/figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{\"knit_meta_id\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"]}},\"value\":[{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"array\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"multirow\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"wrapfig\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"float\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"colortbl\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"pdflscape\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"tabu\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"threeparttable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"threeparttablex\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"ulem\"]},{\"type\":\"character\",\"attributes\":{},\"value\":[\"normalem\"]},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"makecell\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"xcolor\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]}]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}