<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Interactive and dynamic graphics for high-dimensional data using R - 13&nbsp; Trees and forests</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./svm.html" rel="next">
<link href="./LDA.html" rel="prev">
<link href="./cover.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Trees and forests</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Interactive and dynamic graphics for high-dimensional data using R</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./dimension.html" class="sidebar-item-text sidebar-link">Dimension reduction</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dimension-overview.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pca.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Principal component analysis (PCA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nldr.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Non-linear dimension reduction</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./unsupervised.html" class="sidebar-item-text sidebar-link">Unsupervised learning</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./unsupervised-overview.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./brush-and-spin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Spin and brush approach</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hierarchical-clustering.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Hierarchical clustering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./kmeans-clustering.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">k-means clustering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model-based-clustering.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Model-based clustering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./som.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Self-organizing maps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./unsupervised-summary.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Comparing methods</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./unsupervised-ex.html" class="sidebar-item-text sidebar-link">Exercises</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./supervised.html" class="sidebar-item-text sidebar-link">Supervised learning</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LDA.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Linear discriminant analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./forests.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Trees and forests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./svm.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Support vector machine</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nn.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Neural networks and deep learning</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./temporal.html" class="sidebar-item-text sidebar-link">Time series</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multivariate-time-series.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Multiple time series</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./toolbox.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Toolbox</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./glossary.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Glossary</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#trees" id="toc-trees" class="nav-link active" data-scroll-target="#trees"><span class="toc-section-number">13.1</span>  Trees</a></li>
  <li><a href="#random-forests" id="toc-random-forests" class="nav-link" data-scroll-target="#random-forests"><span class="toc-section-number">13.2</span>  Random forests</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Trees and forests</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- Topics to include:

- trees
- forests
- boosted trees
- PP forest
-->
<section id="trees" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="trees"><span class="header-section-number">13.1</span> Trees</h2>
<p>The tree algorithm <span class="citation" data-cites="BFOS84">Breiman et al. (<a href="references.html#ref-BFOS84" role="doc-biblioref">1984</a>)</span> is a simple and versatile algorithmic method for supervised classification. The basic tree algorithm generates a classification rule by sequentially splitting the data into two buckets. Splits are made between sorted data values of individual variables, with the goal of obtaining pure classes on each side of the split. The inputs for a simple tree classifier commonly include (1) an impurity measure, an indication of the relative diversity among the cases in the terminal nodes; (2) a parameter that sets the minimum number of cases in a node, or the minimum number of observations in a terminal node of the tree; and (3) a complexity measure that controls the growth of a tree, balancing the use of a simple generalizable tree against a more accurate tree tailored to the sample. When applying tree methods, exploring the effects of the input parameters on the tree is instructive; for example, it helps us to assess the stability of the tree model.</p>
<p>Although algorithmic models do not depend on distributional assumptions, that does not mean that every algorithm is suitable for all data. For example, the tree model works best when all variables are independent within each class, because it does not take such dependencies into account. Visualization can help us to determine whether a particular model should be applied. In classification problems, it is useful to explore the cluster structure, comparing the clusters with the classes and looking for evidence of correlation within each class. The plots in <a href="LDA.html#fig-lda-assumptions1">Figure&nbsp;<span>5.1</span></a> and <a href="LDA.html#fig-penguins-lda-ellipses">Figure&nbsp;<span>5.3</span></a> shows a strong correlation between the variables within each species, which indicates that the tree model may not give good results for the penguins data. We’ll show how this is the case with two variables initially, and then extend to the four variables.</p>
<div id="fig-p-bl-bd-tree" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mulgar)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorspace)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(classifly)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/penguins_sub.rda"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>p_bl_bd_tree <span class="ot">&lt;-</span> <span class="fu">rpart</span>(species<span class="sc">~</span>bl<span class="sc">+</span>bd, <span class="at">data=</span>penguins_sub)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(p_bl_bd_tree, <span class="at">box.palette=</span><span class="st">"Grays"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-p-bl-bd-tree1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="forests_files/figure-html/fig-p-bl-bd-tree1-1.png" class="img-fluid figure-img" data-ref-parent="fig-p-bl-bd-tree" width="288"></p>
<p></p><figcaption class="figure-caption">(a) Default tree fit</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>p_bl_bd_tree_boundaries <span class="ot">&lt;-</span> <span class="fu">explore</span>(p_bl_bd_tree, penguins_sub)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p_bl_bd_tree_boundaries) <span class="sc">+</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>bl, <span class="at">y=</span>bd, <span class="at">colour=</span>species, <span class="at">shape=</span>.TYPE)) <span class="sc">+</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete_qualitative</span>(<span class="st">"Dark 3"</span>) <span class="sc">+</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="dv">46</span>, <span class="dv">16</span>)) <span class="sc">+</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>, <span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-p-bl-bd-tree2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="forests_files/figure-html/fig-p-bl-bd-tree2-1.png" class="img-fluid figure-img" data-ref-parent="fig-p-bl-bd-tree" width="288"></p>
<p></p><figcaption class="figure-caption">(b) Boundaries of tree fit</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;13.1: The correlation between variables causes problems for using a tree model on the penguins data.</figcaption><p></p>
</figure>
</div>
<p>The plots in <a href="#fig-p-bl-bd-tree">Figure&nbsp;<span>13.1</span></a> show the inadequacies of the tree fit. The background color indicates the class predictions, and thus boundaries produced by the tree fit. They can be seen to be boxy, and missing the elliptical nature of the penguin clusters. This produces errors in the classification of observations which are indefensible. One could always force the tree to fit the data more closely by adjusting the parameters, but the main problem persists: that one is trying to fit elliptical data using boxes.</p>
<p>The boundaries for the tree model on all four variables of the penguins data can be viewed similarly using the tour. The default fitted tree is delightfully simple, with just six splits of the data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>p_tree <span class="ot">&lt;-</span> <span class="fu">rpart</span>(species<span class="sc">~</span>., <span class="at">data=</span>penguins_sub)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(p_tree, <span class="at">box.palette=</span><span class="st">"Grays"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>p_tree_boundaries <span class="ot">&lt;-</span> <span class="fu">explore</span>(p_tree, penguins_sub)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">animate_slice</span>(p_tree_boundaries[p_tree_boundaries<span class="sc">$</span>.TYPE <span class="sc">==</span> <span class="st">"simulated"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="at">col=</span>p_tree_boundaries[p_tree_boundaries<span class="sc">$</span>.TYPE <span class="sc">==</span> <span class="st">"simulated"</span>,<span class="dv">6</span>], <span class="at">v_rel=</span><span class="fl">0.02</span>, <span class="at">axes=</span><span class="st">"bottomleft"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/penguins_tour_path.rda"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">render_gif</span>(p_tree_boundaries[p_tree_boundaries<span class="sc">$</span>.TYPE <span class="sc">==</span> <span class="st">"simulated"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>],</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">planned_tour</span>(pt1),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">display_slice</span>(<span class="at">v_rel=</span><span class="fl">0.02</span>, </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">col=</span>p_tree_boundaries[p_tree_boundaries<span class="sc">$</span>.TYPE <span class="sc">==</span> <span class="st">"simulated"</span>,<span class="dv">6</span>], </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">axes=</span><span class="st">"bottomleft"</span>),                     <span class="at">gif_file=</span><span class="st">"gifs/penguins_tree_boundaries.gif"</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">frames=</span><span class="dv">500</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">loop=</span><span class="cn">FALSE</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>           )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-penguins-lda-tree" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-lda-boundary" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="gifs/penguins_lda_boundaries.gif" class="img-fluid figure-img" alt="FIX ME" data-ref-parent="fig-penguins-lda-tree" width="300"></p>
<p></p><figcaption class="figure-caption">(a) Boundaries produced by the LDA model.</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-tree-boundary" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="gifs/penguins_tree_boundaries.gif" class="img-fluid figure-img" alt="FIX ME" data-ref-parent="fig-penguins-lda-tree" width="300"></p>
<p></p><figcaption class="figure-caption">(b) Boundaries produced by the tree model.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;13.2: Comparison of the boundaries produced by the LDA model and the tree models.</figcaption><p></p>
</figure>
</div>
<!--
% Figure 2
\begin{figure*}[htbp]
\centerline{{\includegraphics[width=5in]{chap-class/missclassifications.pdf}}}
\caption[Classification of the data space for the \Data{Flea
Beetles}]{Classification of the data space for the \Data{Flea
Beetles}, as determined by LDA {\bf (left)} and a tree model {\bf
(right)}. Misclassified cases are highlighted.}
\label{misclassifications}
\end{figure*}


@HTF01 and @Bi06 include thorough discussions of
algorithms for supervised classification presented from a modeling perspective with a theoretical emphasis. @Ri96 is an early volume describing and illustrating both classical statistical methods
and algorithms for supervised classification. All three books contain some excellent examples of the use of graphics to examine two-dimensional (2D) boundaries generated by different classifiers. The discussions in these and other writings on data
mining algorithms take a less exploratory approach than that of this chapter, and they lack treatments of the use of graphics to examine the high-dimensional spaces in which the classifiers operate.
-->

<!--
### Studying the fit

\index{classification!error}
\index{classification!misclassification table}

A classifier's performance is usually assessed using its error or, conversely, its accuracy. Error is calculated by comparing the predicted class with the known true class, using a misclassification table. For example, below are the respective misclassification tables for LDA and the tree classifier applied to the \Data{Flea Beetles}:
-->
<!--
\bigskip
\begin{center}
\begin{tabular}{l@{\hspace{.15in}}r@{\hspace{.15in}}r@{\hspace{.08in}}r@{\hspace{.08in}}r@{\hspace{.3in}}rp{0.4in}
                l@{\hspace{.15in}}r@{\hspace{.15in}}r@{\hspace{.08in}}r@{\hspace{.08in}}r@{\hspace{.3in}}r} 

\multicolumn{6}{l}{LDA} & & \multicolumn{6}{l}{Tree} \\
\cline{1-6}\cline{8-13}\\

 & & \multicolumn{3}{c}{Predicted} & \multicolumn{1}{c}{Error}& &
 & & \multicolumn{3}{c}{Predicted} & \multicolumn{1}{c}{Error}\\

 & & \multicolumn{3}{c}{Class} & \multicolumn{1}{c}{}& &
 & & \multicolumn{3}{c}{Class} & \multicolumn{1}{c}{}\\

 & & 1 & 2 & 3 &  & & 
 & \B & 1 & 2 & 3 &   \\ \cline{3-6} \cline{10-13}

\T & 1 & 20 & 0 & {\bf 1} & 0.048 & & 
   & 1 & 19 & 0 & {\bf 2} & 0.095\\

Class & 2 & 0 & 22 & 0 & 0.000 & & 
Class & 2 & 0 & 22 & 0 & 0.000\\

 & 3  & {\bf 3} & 0 & 28   & 0.097 & & 
 & 3  & {\bf 3} & 0 & 28   & 0.097\\ \cline{3-6} \cline{10-13}
 & \T &         &   &      & 0.054 & &
 &    &         &   &      & 0.068\\
\end{tabular}
\end{center}
\bigskip

\noindent The total error is the number of misclassified samples divided by the total number of cases: $4/74=0.054$ for LDA and $5/74=0.068$ for the tree classifier. 

It is informative to study the misclassified cases and to see which pockets of the data space contain more error. The misclassified cases for LDA and tree classifiers are highlighted (large orange $\times$es and large green circles) in @fig-misclassifications. Some errors made by the tree classifier, such as the uppermost large green circle, seem especially egregious.  As noted earlier, they result from the
limitations of the algorithm when variables are correlated.

\index{cross-validation}

To be useful, the error estimate should predict the performance of the classifier on new samples not yet seen.  However, if the error is calculated using the same data that was used by the classifier, it is
likely to be too low.  Many methods are used to avoid double-dipping from the data, including several types of \Term{cross-validation}.  A simple example of cross-validation is to split the data into a training sample (used by the classifier) and a test sample (used for calculating error).

\index{ensemble method}
\index{classification methods!random forest}

Ensemble methods build cross-validation into the error calculations. Ensembles are constructed by using multiple classifiers and by pooling the predictions using a voting scheme.  A random forest
[@Br01,@Cu04], for example, builds in cross-validation by constructing multiple trees, each of which is generated by randomly sampling the input variables and the cases.  Because each tree is
built using a sample of the cases, there is in effect a training sample and a test sample for each tree.  (See sec-random-forests for more detail.)
-->
<p></p>
</section>
<section id="random-forests" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="random-forests"><span class="header-section-number">13.2</span> Random forests</h2>
<p>A random forest <span class="citation" data-cites="Br01">Breiman and Cutler (<a href="references.html#ref-Cu04" role="doc-biblioref">2004</a>)</span> is a classifier that is built from multiple trees generated by randomly sampling the cases and the variables. The random sampling (with replacement) of cases has the fortunate effect of creating a training (“in-bag”) and a test (“out-of-bag”) sample for each tree computed. The class of each case in the out-of-bag sample for each tree is predicted, and the predictions for all trees are combined into a vote for the class identity.</p>
<p>A random forest is a computationally intensive method, a “black box” classifier, but it produces several diagnostics that make the outcome less mysterious. Some diagnostics that help us to assess the model are the votes, the measure of variable importance, and the proximity matrix.</p>
<p>Here we show how to use the <code>randomForest</code> <span class="citation" data-cites="Li06">(<a href="references.html#ref-Li06" role="doc-biblioref">Liaw et al. 2006</a>)</span> votes matrix for the penguins datato investigate confusion between classes, and observations which are problematic to classify. With only three classes the votes matrix is only a 2D object, and thus easy to examine. With four or more classes the votes matrix needs to be examined in a tour.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>penguins_rf <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(species<span class="sc">~</span>.,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">data=</span>penguins_sub,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">importance=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># animate_xy(penguins_rf$votes, col=penguins_sub$species)</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Project 4D into 3D</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geozoo)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>proj <span class="ot">&lt;-</span> <span class="fu">t</span>(geozoo<span class="sc">::</span><span class="fu">f_helmert</span>(<span class="dv">3</span>)[<span class="sc">-</span><span class="dv">1</span>,])</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>p_rf_v_p <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(penguins_rf<span class="sc">$</span>votes) <span class="sc">%*%</span> proj</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(p_rf_v_p) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>p_rf_v_p <span class="ot">&lt;-</span> p_rf_v_p <span class="sc">%&gt;%</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">species =</span> penguins_sub<span class="sc">$</span>species)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add simplex</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>simp <span class="ot">&lt;-</span> <span class="fu">simplex</span>(<span class="at">p=</span><span class="dv">2</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>sp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(simp<span class="sc">$</span>points), simp<span class="sc">$</span>points[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>),])</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>, <span class="st">"x4"</span>)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>sp<span class="sc">$</span>species <span class="ot">=</span> <span class="fu">sort</span>(<span class="fu">unique</span>(penguins_sub<span class="sc">$</span>species))</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>p_ternary <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data=</span>sp, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">xend=</span>x3, <span class="at">yend=</span>x4)) <span class="sc">+</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span>sp, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">label=</span>species),</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_x=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.06</span>, <span class="fl">0.07</span>, <span class="dv">0</span>),</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_y=</span><span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="sc">-</span><span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>p_rf_v_p, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">colour=</span>species), <span class="at">size=</span><span class="dv">2</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete_qualitative</span>(<span class="st">"Dark 3"</span>) <span class="sc">+</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>, <span class="at">legend.position=</span><span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">render_gif</span>(penguins_rf<span class="sc">$</span>votes,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>           <span class="fu">grand_tour</span>(),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">display_xy</span>(<span class="at">v_rel=</span><span class="fl">0.02</span>, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">col=</span>penguins_sub<span class="sc">$</span>species, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">axes=</span><span class="st">"bottomleft"</span>),                     <span class="at">gif_file=</span><span class="st">"gifs/penguins_rf_votes.gif"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">frames=</span><span class="dv">500</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">loop=</span><span class="cn">FALSE</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>           )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-penguins-votes" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-p-votes-tour" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="gifs/penguins_rf_votes.gif" class="img-fluid figure-img" alt="FIX ME" data-ref-parent="fig-penguins-votes" width="300"></p>
<p></p><figcaption class="figure-caption">(a) Votes matrix in a tour.</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="cell-output-display">
<div id="fig-p-votes-ggplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="forests_files/figure-html/fig-p-votes-ggplot-1.png" class="img-fluid figure-img" data-ref-parent="fig-penguins-votes" width="384"></p>
<p></p><figcaption class="figure-caption">(b) Votes marix in its 2D space, a ternary diagram.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;13.3: Examining the votes matrix from a random forest fit to the penguins.</figcaption><p></p>
</figure>
</div>
<p>The votes matrix, reports the proportion of trees each observation is classified as each class. From the tour of the votes matrix, it can be seen to be 2D in 3D space. This is due to the constraint that the three proportions for each observation sum to 1. Using a Helmert matrix, this data can be projected into the 2D space, or more generally the <span class="math inline">\((g-1)\)</span>-dimensional space where it resides. In 2D this is called a ternary diagram, and in higher dimensions the bounding shapes might be considered to be a simplex. The vertices of this shape correspond to <span class="math inline">\((1,0,0), (0,1,0), (0,0,1)\)</span> (and analogously for higher dimensions), which represent perfect confidence, that an observation is classified into that group all the time.</p>
<p>What we can see here is a concentration of points in the corners of the triangle indicates that most of the penguins are confidently classified into their correct class. Then there is more separation between the Gentoo and the others, than between Chinstrap and Adelie. That means that as a group Gentoo are more distinguishable. Only one of the Gentoo penguins has substantial confusion, mostly confused as a Chinstrap, but occasionally confused as an Adelie – if it was only ever confused as a Chinstrap it would fall on the edge between Gentoo and Chinstrap. There are quite a few Chinstrap and Adelie penguins confused as each other, with a couple of each more confidently predicted to be the other class. This can be seen because there are points of the wrong colour close to those vertices.</p>
<p>The votes matrix is useful for investigating the fit, but one should remember that there are some structural elements of this data that don’t lend themselves to tree models. Although a forest has the capacity to generate non-linear boundaries by combining predictions from multiple trees, it is still based on the boxy boundaries of trees. This makes it less suitable for the penguins data with elliptical classes. You could use the techniques from the previsou section to explore the boundaries produced by the forest, and you will find that the are more boxy than the LDA models.</p>
<p>To examine a vote matrix for a problem with more classes, we’ll look at the bushfires data. There are four classes: accident, arson, burning_off, lightning. It is highly imbalanced, with most observations belonging to the lightning class, fires ignited by lightning. We can see that most of the observations lie on the face of lightning, arson and accident. The handful of the burning_off observations lie off this plane, in the direction of burning-off, so are less confused with the other three classes. This could be expected because burning off is highly regulated, and tends to occur before the bushfire season is at risk of starting. The arson cases are hard to classify, frequently confused with lightning or accident, and occasionally burning off. Lightning and accident have many more observations that are confidently classified correctly.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mulgar)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tourr)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(bushfires)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>bushfires_sub <span class="ot">&lt;-</span> bushfires[,<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">8</span><span class="sc">:</span><span class="dv">45</span>, <span class="dv">48</span><span class="sc">:</span><span class="dv">55</span>, <span class="dv">57</span><span class="sc">:</span><span class="dv">60</span>)] <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cause =</span> <span class="fu">factor</span>(cause))</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>bushfires_pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(bushfires_sub[,<span class="sc">-</span><span class="dv">51</span>],</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">scale=</span><span class="cn">TRUE</span>, <span class="at">retx=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggscree</span>(bushfires_pca)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>bushfires_pcs <span class="ot">&lt;-</span> bushfires_pca<span class="sc">$</span>x[,<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>] <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cause =</span> <span class="fu">factor</span>(bushfires<span class="sc">$</span>cause))</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tourr)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="fu">animate_xy</span>(bushfires_pcs[,<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>],</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>           <span class="fu">guided_tour</span>(<span class="fu">lda_pp</span>(bushfires_pcs<span class="sc">$</span>cause)),</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">col=</span>bushfires_pcs<span class="sc">$</span>cause)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>bushfires_pca<span class="sc">$</span>rotation[,<span class="dv">2</span>]</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bushfires, <span class="fu">aes</span>(<span class="at">x=</span>FOR_CODE)) <span class="sc">+</span> <span class="fu">geom_density</span>()</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bushfires, <span class="fu">aes</span>(<span class="at">x=</span>COVER)) <span class="sc">+</span> <span class="fu">geom_density</span>()</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bushfires, <span class="fu">aes</span>(<span class="at">x=</span>HEIGHT)) <span class="sc">+</span> <span class="fu">geom_density</span>()</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bushfires, <span class="fu">aes</span>(<span class="at">x=</span>FOREST)) <span class="sc">+</span> <span class="fu">geom_density</span>()</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bushfires, <span class="fu">aes</span>(<span class="at">x=</span>arf28)) <span class="sc">+</span> <span class="fu">geom_density</span>()</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>bushfires_rf <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(cause<span class="sc">~</span>.,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>                             <span class="at">data=</span>bushfires_sub,</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>                             <span class="at">importance=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>bushfires_rf_votes <span class="ot">&lt;-</span> bushfires_rf<span class="sc">$</span>votes <span class="sc">%&gt;%</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cause =</span> bushfires_sub<span class="sc">$</span>cause)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="fu">animate_xy</span>(bushfires_rf_votes[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>],</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>           <span class="at">col=</span>bushfires_rf_votes<span class="sc">$</span>cause)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Project 4D into 3D</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geozoo)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>proj <span class="ot">&lt;-</span> <span class="fu">t</span>(geozoo<span class="sc">::</span><span class="fu">f_helmert</span>(<span class="dv">4</span>)[<span class="sc">-</span><span class="dv">1</span>,])</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>b_rf_v_p <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(bushfires_rf_votes[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]) <span class="sc">%*%</span> proj</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(b_rf_v_p) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>)</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>b_rf_v_p <span class="ot">&lt;-</span> b_rf_v_p <span class="sc">%&gt;%</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cause =</span> bushfires_sub<span class="sc">$</span>cause)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Add simplex</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>simp <span class="ot">&lt;-</span> <span class="fu">simplex</span>(<span class="at">p=</span><span class="dv">3</span>)</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>sp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(simp<span class="sc">$</span>points)</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>)</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>sp<span class="sc">$</span>cause <span class="ot">=</span> <span class="st">""</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>b_rf_v_p_s <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(sp, b_rf_v_p) <span class="sc">%&gt;%</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cause =</span> <span class="fu">factor</span>(cause))</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"accident"</span> , <span class="st">"arson"</span>, </span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>                <span class="st">"burning_off"</span>, <span class="st">"lightning"</span>, </span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rep</span>(<span class="st">""</span>, <span class="dv">1021</span>))</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="fu">animate_xy</span>(b_rf_v_p_s[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">col =</span> b_rf_v_p_s<span class="sc">$</span>cause, </span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>           <span class="at">axes =</span> <span class="st">"off"</span>, <span class="at">half_range =</span> <span class="fl">1.3</span>,</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>           <span class="at">edges =</span> <span class="fu">as.matrix</span>(simp<span class="sc">$</span>edges),</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>           <span class="at">obs_labels =</span> labels)</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a><span class="fu">render_gif</span>(b_rf_v_p_s[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>],</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>           <span class="fu">grand_tour</span>(),</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>           <span class="fu">display_xy</span>(<span class="at">col =</span> b_rf_v_p_s<span class="sc">$</span>cause, </span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>           <span class="at">axes =</span> <span class="st">"off"</span>, <span class="at">half_range =</span> <span class="fl">1.3</span>,</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>           <span class="at">edges =</span> <span class="fu">as.matrix</span>(simp<span class="sc">$</span>edges),</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>           <span class="at">obs_labels =</span> labels),</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>           <span class="at">gif_file=</span><span class="st">"gifs/bushfires_votes.gif"</span>,</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>           <span class="at">frames=</span><span class="dv">500</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-b-votes" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="gifs/bushfires_votes.gif" class="img-fluid figure-img" alt="FIX ME" width="300"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;13.4: The 3D votes matrix for the four class bushfires data in a tour.</figcaption><p></p>
</figure>
</div>
<p></p>

<!--
We test the method on the \Data{Olive Oils} by building a random forest classifier of 500 trees, using the R package `randomForest` [@Li06]:


\begin{verbatim}
> library(randomForest)
> olive.rf <- randomForest(as.factor(region)~., 
  data=d.olive.sub, importance=TRUE, proximity=TRUE, mtry=4)
> order(olive.rf$importance[,5], decreasing=T)
[1] 8 5 4 1 7 2 6 3
> pred <- as.numeric(olive.rf$predicted)
\end{verbatim}
\newpage  % Insert page break to avoid breaking the R output.
\begin{verbatim}
> table(d.olive.sub[,1], olive.rf$predicted)
      1   2   3
  1 323   0   0
  2   0  98   0
  3   0   0 151
> margin <- olive.rf$vote
> colnames(margin) <- c("Vote1", "Vote2", "Vote3")
> d.olive.rf <- cbind(pred, margin, d.olive)
> gd <- ggobi(d.olive.rf)[1]
> glyph_color(gd) <- c(rep(6,323), rep(5,98), rep(1,151))
\end{verbatim}
-->
<!--
% Figure 11
\begin{figure*}[h]
\centerline{
  {\includegraphics[width=2.0in]{chap-class/olive-forest1.pdf}}
  {\includegraphics[width=2.0in]{chap-class/olive-forest2.pdf}}}
\smallskip
\centerline{
  {\includegraphics[width=2.0in]{chap-class/olive-forest9.pdf}}}
\caption[Examining the results of a forest classifier of \Data{Olive
Oils}]{Examining the results of a forest classifier of \Data{Olive
Oils} by `region`.  The votes assess the uncertainty associated
with each sample.  The cases classified with the greatest uncertainty
lie far from the corners of the triangles.  These points are brushed
{\bf (top left)}, and we examine their location using the linked tour
plot {\bf (top right)}.  The introduction of `linoarach` {\bf
(bottom)} eliminates the confusion between Sardinia and the North. }
\label{olive-forest}
\end{figure*}


\noindent Each tree used a random sample of four of the eight variables, as well as a random sample of about a third of the 572 cases.  The votes are displayed in the left-hand plot of @fig-olive-forest, next to a projection from a
\index{tour!grand} 2D tour. Since there are three classes, the votes form a triangle, with one vertex for each region, with oils from the South at the far right, Sardinian oils at the top, and Northern oils
at the lower left. Samples that are consistently classified correctly are close to the vertices; cases that are commonly misclassified are
further from a vertex.  Although forests perfectly classify this data, the number of points falling between the Northern and the Sardinian vertices suggests some potential for error in classifying future samples.

For more understanding of the votes, we turn to another diagnostic: variable importance. Forests return two measures of variable importance, both of which give similar results. Based on the Gini measure, the most important variables, in order, are `eicosenoic`, `linoleic`, `oleic`, `palmitic`, `arachidic`, `palmitoleic`, `linolenic`, and `stearic`.  

Some of this ordering is as expected, given the initial graphical inspection of the data (@sec-class-plots).  The importance of `eicosenoic` was our first discovery, as shown in the top row of
@fig-olive-1d.  And yes, `linoleic` is next in importance: The first two plots in @fig-olive-2d make that clear.  The surprise is that the forest should consider `arachidic` to be less
important than `palmitic`.  This is not what we found, as shown in the right-hand plot in that figure.

Did we overlook something important in our earlier investigation?  We return to the use of the manual manipulation of the tour \index{tour!manual} to see whether `palmitic` does in fact perform better than `arachidic` at finding a gap between the two regions. But it does not.  By overlooking the importance of `arachidic`, the random forest never finds an adequate gap between the oils of the
Northern and the Sardinian regions, and that probably explains why there is more confusion about some Northern samples than there should be.

We rebuild the forest using a new variable constructed from a linear combination of `linoleic` and `arachidic` (`linoarach`), just as we did when applying the single tree classifier.  Since correlated variables reduce each other's importance, we need to remove `linoleic` and `oleic` when we add `linoarach`.  Once we have done this, the confusion between Northern and Sardinian oils disappears @fig-olive-forest, lower plot): The points are now
tightly clumped at each vertex, which indicates more certainty in their class predictions. The new variable becomes the second most important variable according to the importance diagnostic.

Classifying the oils by the three large `region`s is too easy a problem for forests; they are designed to tackle more challenging classification tasks. We will use them to examine the oils from the
areas in the Southern region (North and South Apulia, Calabria, and Sicily). Remember the initial graphical inspection of the data, which showed that oils from the four areas were not completely
separable. The samples from Sicily overlapped those of the three other areas.  We will use a forest classifier to see how well it can differentiate the Southern oils by `area`:

\begin{verbatim}
> d.olive.sth <- subset(d.olive, region==1, 
   select=area:eicosenoic)
> olive.rf <- randomForest(as.factor(area)~., 
   data=d.olive.sth, importance=TRUE, proximity=TRUE, 
   mtry=2, ntree=1500)
> order(olive.rf$importance[,5], decreasing=T)
[1] 5 2 4 3 1 6 7 8
> pred <- as.numeric(olive.rf$predicted)
> table(d.olive.sth[,1], olive.rf$predicted)
      1   2   3   4
  1  22   2   0   1
  2   0  53   2   1
  3   0   1 202   3
  4   3   4   5  24
> margin <- olive.rf$vote
> colnames(margin) <- c("Vote1", "Vote2", "Vote3", "Vote4")
> d.olive.rf <- cbind(pred, margin, d.olive.sth)
> gd <- ggobi(d.olive.rf)[1]
> glyph_color(gd) <- c(6,3,2,9)[d.olive.rf$area]
\end{verbatim} 

\noindent After experimenting with several input parameters, we show the results for a forest of 1,500 trees, sampling two variables at each
tree node, and yielding an error rate of 0.068.  The misclassification table is:
-->
<!--
\bigskip
\begin{center}
\begin{tabular}{l@{\hspace{.3in}}r@{\hspace{1em}}r@{\hspace{1em}}r@{\hspace{1em}}r@{\hspace{1.5em}}r@{\hspace{2em}}r}
\B & & \multicolumn{4}{c}{Predicted `area`} & Error \\

\T & & \multicolumn{1}{c}{North}  & \multicolumn{1}{c}{Calabria} & \multicolumn{1}{c}{South}  & \multicolumn{1}{c}{Sicily} &  \\
\B & & \multicolumn{1}{c}{Apulia} &  & \multicolumn{1}{c}{Apulia} & & \\\cline{3-7}

\T         & North Apulia & 22 & {\bf 2} & 0 & {\bf 1} & 0.120 \\
`area` & Calabria & 0 & 53 & {\bf 2} & {\bf 1} & 0.054 \\
           & South Apulia & 0 & {\bf 1} & 202 & {\bf 3} & 0.019 \\
           & Sicily & {\bf 3} & {\bf 4} & {\bf 5} & 24 & 0.333 \\ \cline{3-7}
\T         &        &         &         &         &    &  0.068
\end{tabular}
\end{center}
\bigskip

\noindent The error of the forest is surprisingly low, but the  error is definitely not uniform across classes. Predictions for Sicily are wrong about a third of the time. Figure~\ref{olive-forest2} shows
some more interesting aspects of the results.  For this figure, the following table describes the correspondence between area and symbol:
-->
<!--
\begin{center}
\begin{tabular}{l@{\hspace{.3in}}l} %\hline
\T \B `area` & symbol \\\hline
\T  North Apulia   &  orange $+$ \\
  Calabria  &    red $+$ \\
  South Apulia  &    pink $\times$ \\
\B  Sicily  &    yellow $\times$ \\\hline
\end{tabular}
\end{center}


\index{jittering}

\noindent Look first at the top row of the figure.  The misclassification table is represented by a jittered scatterplot, at the left.  A plot from a 2D tour \index{tour!grand} of the four voting variables is in the center.  Because there are four groups, the votes lie on a 3D tetrahedron (a simplex).  The votes from three of the areas are pretty well separated, one at each ``corner,'' but those
from Sicily overlap all of them.  Remember that when points are clumped at the vertex, class members are consistently predicted correctly.  Since this does not occur for Sicilian oils, we see that there is more uncertainty in the predictions for this area.

The plot at right confirms this observation. It is a projection from a 2D tour \index{tour!grand} of the four most important variables, showing a pattern we have seen before.  We can achieve pretty good separation of the oils from North Apulia, Calabria, and South Apulia, but the oils from Sicily overlap all three clusters.  Clearly these are tough samples to classify correctly.
-->
<!--
% Figure 12
\begin{figure*}[htbp]
\centerline{
  {\includegraphics[width=1.5in]{chap-class/olive-sth-forest1.pdf}}
  {\includegraphics[width=1.5in]{chap-class/olive-sth-forest7.pdf}}
  {\includegraphics[width=1.5in]{chap-class/olive-sth-forest3.pdf}}}
\smallskip
\centerline{
  {\includegraphics[width=1.5in]{chap-class/olive-sth-forest4.pdf}}
  {\includegraphics[width=1.5in]{chap-class/olive-sth-forest5.pdf}}
  {\includegraphics[width=1.5in]{chap-class/olive-sth-forest6.pdf}}}
\caption[Examining the results of a random forest after classifying
the oils of the South]{Examining the results of a random forest after
classifying the oils of the South by area}.  A representation of
the misclassification table {\bf (left)} is linked to plots of the
votes {\bf (middle)} and a 2D tour {\bf (right)}.  The Sicilian oils
have been excluded from the plots in the bottom row.}
\label{olive-forest2}
\end{figure*}


We remove the Sicilian oils from the plots so we can focus on the other three areas (bottom row of plots). The points representing North Apulian oils form a very tight cluster at a vertex, with three
exceptions. Two of these points are misclassified as Calabrian, and we have highlighted them as large filled circles by painting the misclassification plot.

The pattern of the votes (middle plot) suggests that there is high certainty in the predictions for North Apulian oils, with the exception of these two samples.  When we watch the votes in the tour
\index{tour!grand} for a while, we see that the votes of these two samples travel as if they were in a cluster all their own, which is distinct from the remaining North Apulian oils.

However, when we look at the data, we find the votes for these two samples a bit puzzling.  We watch the four most important variables in the tour for a while (as in the right plot), and these two points
do not behave as if they were in a distinct cluster; they travel with the rest of the samples from North Apulia.  They do seem to be outliers with respect their class, but they are not so far from their
group - it is a bit surprising that the forest has trouble classifying these cases.

Rather than exploring the other misclassifications, we leave that for the reader.

In summary, a random forest is a useful method for tackling tough classification problems.  Its diagnostics provide a rich basis for graphical exploration, which helps us to digest and evaluate the solution.
-->
</section>
<section id="exercises" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercises">Exercises</h2>
<ol type="1">
<li>Compare the boundaries from the random forest model on the penguins data to that of the (a) LDA model, (b) a default tree model.</li>
<li>Tinker with the parameters of the tree model to force it to fit a tree more closely to the data. Compare the boundaries from this with the default tree, and with the forest model. Is it less boxy than the default tree, but more boxy than the forest model? <!--
1. For the \Data{Italian Olive Oils}:
    a. Split the samples from North Italy into $2/3$ training and
$1/3$ test samples for each area.
    b. Build a tree model to classify the oils by `area` for the
three areas of North Italy. Which are the most important
variables? Make plots of these variables. What is the accuracy of the
model for the training and test sets?
    c. Build a random forest to classify oils into the three areas of
North Italy. Compare the order of importance of variables with what
you found from a single tree. Make a parallel coordinate plot in the
order of variable importance.
--></li>
</ol>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-Br01" class="csl-entry" role="doc-biblioentry">
Breiman, L. 2001. <span>“Random <span>F</span>orests.”</span> <em>Machine Learning</em> 45 (1): 5–32.
</div>
<div id="ref-Cu04" class="csl-entry" role="doc-biblioentry">
Breiman, L., and A. Cutler. 2004. <span>“Random <span>F</span>orests.”</span> <span><code>http://www.math.usu.edu/</code><span class="math inline">\(\sim\)</span><code>adele/forests/cc_home.htm</code></span>.
</div>
<div id="ref-BFOS84" class="csl-entry" role="doc-biblioentry">
Breiman, L., J. Friedman, C. Olshen, and C. Stone. 1984. <em>Classification and <span>R</span>egression <span>T</span>rees</em>. Monterey, CA: Wadsworth; Brooks/Cole.
</div>
<div id="ref-Li06" class="csl-entry" role="doc-biblioentry">
Liaw, A., M. Wiener, L. Breiman, and A. Cutler. 2006. <span>“<span><code>randomForest</code></span>: <span>B</span>reiman and <span>C</span>utler’s <span>R</span>andom <span>F</span>orests for <span>C</span>lassification and <span>R</span>egression.”</span> <span><code>http://www.R-project.org</code></span>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./LDA.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Linear discriminant analysis</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./svm.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Support vector machine</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>