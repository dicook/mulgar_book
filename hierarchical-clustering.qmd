# Hierarchical clustering {#chap-hclust}

\index{cluster analysis!algorithms}

\index{cluster analysis!hierarchical}
\index{cluster analysis!intercluster distance (linkage)}

Hierarchical cluster algorithms sequentially fuse neighboring points to form ever-larger clusters, starting from a full interpoint distance
matrix. \Term{Distance between clusters} is described by a "linkage method": For example, single linkage uses the smallest interpoint distance between the members of a pair of clusters, complete linkage
uses the maximum interpoint distance, and average linkage uses the average of the interpoint distances. A good discussion on cluster analysis can be found in @JW02 or @Ev01.

@fig-prim7-hier contains several plots that illustrate the results of the hierarchical clustering of the particle physics data; we used Euclidean interpoint distances and the average linkage method. This is computed by:

```
> library(rggobi)
> d.prim7 <- read.csv("prim7.csv")
> d.prim7.dist <- dist(d.prim7)
> d.prim7.dend <- hclust(d.prim7.dist, method="average")
> plot(d.prim7.dend)
```

\index{cluster analysis!dendrogram}

\noindent The dendrogram at the top shows the result of the clustering process. Several large clusters were fused late in the process, with heights (indicated by the height of the horizontal segment connecting two
clusters) well above those of the first joins; we will want to look at these.  Two points were fused with the rest at the very last stages, which indicates that they are outliers and have been assigned to
singleton clusters.

<!--
% Figure 5
\begin{figure*}[htbp]
\centerline{{\includegraphics[width=3.5in]{chap-clust/prim7-dendrogram.pdf}}}
\smallskip
\centerline{{\includegraphics[width=1.2in]{chap-clust/prim7-clust1.pdf}}
 {\includegraphics[width=1.2in]{chap-clust/prim7-clust2.pdf}}
 {\includegraphics[width=1.2in]{chap-clust/prim7-clust3.pdf}}}
\smallskip
\centerline{{\includegraphics[width=1.2in]{chap-clust/prim7-clust5.pdf}}
 {\includegraphics[width=1.2in]{chap-clust/prim7-clust6.pdf}}
 {\includegraphics[width=1.2in]{chap-clust/prim7-clust7.pdf}}}
\caption[Hierarchical clustering of the particle physics
data]{Hierarchical clustering of the particle physics data.  The
dendrogram shows the results of clustering the data using average
linkage.  Clusters 1, 2, and 3 carve up the base triangle of the data;
clusters 5 and 6 divide one of the arms; and cluster 7 is a singleton.
}
\label{prim7-hier}
\end{figure*}
-->

\index{outliers}
\index{animation}
\index{brushing!transient}
We cut the dendrogram to produce nine clusters because we would expect to see seven clusters and a few outliers based on our observations from the spin and brush approach, and our choice looks reasonable given the structure of the dendrogram.  (In practice, we would usually explore the clusters corresponding to several different cuts of the dendrogram.) We assign each cluster an integer identifier, and in the following plots, you see the results of highlighting one cluster at a time and then running the grand tour to focus on the placement of that cluster within the data. This R code follows this sequence of actions:

```
> gd <- ggobi(d.prim7)[1]
> clust9 <- cutree(d.prim7.dend, k=9)
> glyph_color(gd)[clust9==1] <- 9 # highlight triangle
> glyph_color(gd)[clust9==1] <- 1 # reset color
> glyph_color(gd)[clust9==2] <- 9 # highlight cluster 2
```

The top three plots show, respectively, clusters 1, 2, and 3: These clusters roughly divide the main triangular section of the data into three. The bottom row of plots show clusters labeled 5, and 6, which
lie along the linear pieces, and cluster 7, which is a singleton cluster corresponding to an outlier in the data.

The results are reasonably easy to interpret. Recall that the basic geometry underlying this data is that there is a 2D triangle with two linear strands extending from each vertex.  The hierarchical average
linkage clustering of the particle physics data using nine clusters essentially divides the data into three chunks in the neighborhood of each vertex (clusters 1, 2, and 3), three pieces at the ends of the six linear strands (4, 5, and 6), and three clusters containing
outliers (7, 8, and 9).  This data provides a big challenge for any cluster algorithm - low-dimensional pieces embedded in high-dimensional space - and we are not surprised that no algorithm that we have tried will extract the structure we found using interactive tools.

The particle physics dataset is ill-suited to hierarchical clustering, but this extreme failure is an example of a common problem.  When performing cluster analysis, we want to group the observations into clusters without knowing the distribution of the data.  How many clusters are appropriate? What do the clusters look like?  Could we just as confidently divide the data in several different ways and get
very different but equally valid interpretations? Graphics can help us assess the results of a cluster analysis by helping us explore the distribution of the data and the characteristics of the clusters.

\index{cluster analysis!model-based}

